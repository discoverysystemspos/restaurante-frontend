<!-- =========================================================================
    HEADER 
========================================================================= -->

<header>
    <div class="bg-header-blue py-2 px-3 mb-2">
        <h5 class="text-white m-0">Facturas</h5>
    </div>

    <ul class="nav nav-tabs px-3" id="myTab" role="tablist">

        <li class="nav-item" role="presentation">
            <a class="nav-link text-dark active" id="facturas-tab"><i class="bi-journal-check" style="font-size: 1rem"></i> Alquiler <span *ngIf="alquiler"> #{{alquiler.number}} </span> </a>
        </li>

    </ul>

</header>

<!-- =========================================================================
    HEADER 
========================================================================= -->
<div class="container-fluid">


    <ng-container *ngIf="alquiler">
        <!-- TITLE - SUBTITLE -->
        <div class="mt-4">
            <h5 class="text-dark">DETALLES DEL ALQUILER #{{ alquiler.number }}</h5>
            <p class="mb-0">Cajero: {{ alquiler.user.name }}</p>

        </div>
        <!-- TITLE - SUBTITLE -->

        <div>

            <!-- <ng-container *ngIf="empresa">
                <button *ngIf="empresa.printpos" [routerLink]="['/dashboard/ventas/print', factura.iid]" type="button" class="btn btn-outline-primary btn-sm mx-1 my-2"> 
                    <i class="bi-printer"></i> Imprimir
                </button>

                <button *ngIf="!empresa.printpos" (click)="printDiv()" type="button" class="btn btn-outline-primary btn-sm mx-1 my-2"> 
                    <i class="bi-printer"></i> Imprimir
                </button>
            </ng-container> -->

            <button (click)="printDiv()" type="button" class="btn btn-outline-primary btn-sm mx-1 my-2"> 
                <i class="bi-printer"></i> Imprimir
            </button>

            <!-- facturarAlquiler -->
            <button *ngIf="!alquiler.finalizada" type="button" class="btn btn-outline-success btn-sm mx-1 my-2" data-bs-toggle="modal" data-bs-target="#facturarAlquiler"> 
                <i class="bi-check"></i> Liquidar
            </button>

        </div>

        <div class="row">


            <!-- DETALLES DE LA FACTURA -->
            <div class="col-md-8 shadow-lg p-3 mb-5 rounded bg-white">

                <div id="printDiv">

                    <!-- INFORMACION DEL CLIENTE -->
                    <div class="row">

                        <!-- Informacion del Cliente -->
                        <div class="col-md-8 text-left text-muted" style="color:black">

                            <div class="mb-2" *ngIf="empresa">
                                <!-- Image Product-->
                                <img *ngIf="empresa.logo" [src]=" empresa.logo | imagen:'logo'" class="mx-auto" width="200px" alt="">
                            </div>

                            <div class="row" style="color:black">
                                <div class="col-md-4">
                                    <h6 class="text-wrap mb-0 text-capitalize"><strong>CLIENTE / RAZON SOCIAL:  </strong><br><small>{{ alquiler.client?.name || 'Ocasional' }}</small></h6>
                                </div>
                                <div class="col">
                                    <h6 class="text-wrap mb-0 text-capitalize"><strong>CC / Nit: </strong> <br><small> {{ alquiler.client?.cedula || '00000000' }}</small></h6>
                                </div>
                            </div>

                            <div class="row" style="color:black">
                                <div class="col-md-4">
                                    <h6 class="text-wrap mb-0 text-capitalize"><strong>TELEFONO: </strong> <br><small *ngIf="alquiler.client?.phone"> {{ alquiler.client?.phone }}</small> </h6>
                                </div>
                                <div class="col">
                                    <h6 class="text-wrap mb-0"><strong>CORREO: </strong> <br><small *ngIf="alquiler.client?.email"> {{ alquiler.client?.email }} </small></h6>
                                </div>
                            </div>

                            <div class="row" style="color:black">
                                <div class="col">
                                    <h6 class="text-wrap mb-0"><strong>DIRECCIÓN: </strong> <br><small *ngIf="alquiler.client?.address"> {{ alquiler.client?.address }} <span *ngIf="alquiler.client?.city" > {{ alquiler.client?.city }} </span></small></h6>

                                </div>
                            </div>

                        </div>

                        <div class="col">
                            <div class="col-12" *ngIf="empresa">
                                <!-- <div class="mb-2 d-flex justify-content-end">
                                <img *ngIf="empresa.logo" src="{{empresa.logo | imagen:'logo'}}" class="" width="200px" alt="">
                            </div> -->
                                <h5 class="mb-0 d-flex justify-content-end text-wrap text-end fw-bold"> {{ empresa.name }} </h5>
                                <p class="mb-0 d-flex justify-content-end text-wrap text-end"> {{ empresa.address }} </p>
                                <p class="mb-0 d-flex justify-content-end text-wrap text-end">Nit: {{ empresa.nit }} </p>

                                <small *ngIf="!empresa.impuesto" class="mb-0 d-flex justify-content-end"> No responsable de IVA </small>

                                <!-- RESPONSABLE DE IVA O IMPUESTO AL CONSUMO -->
                                <small *ngIf="empresa.impuesto && empresa.responsable" class="mb-0 d-flex justify-content-end"> Responsable de iva </small>
                                <small *ngIf="empresa.impuesto && empresa.impuestoconsumo" class="mb-0 d-flex justify-content-end text-right"> Responsable nacional al consumo </small>

                                <small *ngIf="empresa.impuesto" class="mb-0 d-flex justify-content-end"> Resolución: {{ empresa.resolucion }} </small>
                                <small *ngIf="empresa.impuesto" class="mb-0 d-flex justify-content-end"> Prefijo Pos: {{ empresa.prefijopos }} </small>
                                <!-- RESPONSABLE DE IVA O IMPUESTO AL CONSUMO -->

                                <h3 class="display-5 mb-0 d-flex justify-content-end text-primary"> {{ alquiler.number }} </h3>
                                <small class="mb-0 d-flex justify-content-end"> {{ alquiler.fecha | date:'medium' }} </small>

                            </div>
                        </div>

                    </div>
                    <!-- INFORMACION DEL CLIENTE -->



                    <div class=" table-responsive ">

                        <table class="table table-borderless table-striped table-sm ">
                            <thead class="border-bottom">
                                <tr>
                                    <th scope="col">Cant.</th>
                                    <th scope="col">Producto</th>
                                    <th scope="col">Precio</th>
                                    <th class="text-center" scope="col">Fechas</th>
                                    <th class="text-center" scope="col">Dias</th>
                                    <th class="text-end" scope="col">Monto</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody class="text-dark">

                                <tr *ngIf="alquiler.items.length === 0">
                                    <th colspan="6">No se a seleccionado ningun producto...</th>
                                </tr>

                                <ng-container *ngIf="alquiler.items.length > 0">
                                    <tr *ngFor="let item of alquiler.items">
                                        <td> {{ item.qty }} </td>
                                        <td> {{ item.product.name }} </td>
                                        <td> {{ item.price | currency: 'COP' }} </td>
                                        <td>
                                            <div class="d-flex justify-content-center gap-2">
                                                <span class="badge bg-dark" *ngIf="item.desde"> {{item.desde | date:'dd/M/y'}} </span>
                                                <span class="badge bg-success" *ngIf="item.hasta"> {{item.hasta | date:'dd/M/y'}} </span>
                                            </div>
                                        </td>
                                        <td class="text-center"> {{ item.dias }} </td>
                                        <td class="text-end"> {{ (item.price * item.qty) * item.dias | currency: 'COP' }} </td>

                                        <td>
                                            <button (click)="entregaProductos(item)" *ngIf="!item.entregado" type="button" class="btn btn-link p-1 text-primary text-right"> 
                                                <i class="bi-arrow-counterclockwise"></i> 
                                            </button>

                                            <span *ngIf="item.entregado" class="text-success"> <i class="bi-check"></i>  </span>
                                        </td>

                                    </tr>
                                </ng-container>

                            </tbody>
                            <tfoot>
                                <tr>
                                    <th colspan="5" class="text-end">Total</th>
                                    <th class="text-end"> {{ amount | currency:'COP'}} </th>
                                </tr>
                            </tfoot>
                        </table>

                    </div>

                </div>

                <!-- INFORMACION DE LA FACTURA -->

            </div>
            <!-- DETALLES DE LA FACTURA -->

            <!-- PAGOS -->
            <div class="col-md-4">

                <!-- TABLE PAGOS-->
                <div class="shadow-lg p-3 mb-5 rounded bg-white" style="max-height: 400px; height: auto;">

                    <div class="d-flex">

                        <h5 class="">
                            Pagos
                        </h5>

                        <div class="ms-auto">
                            <button *ngIf="user.cerrada" (click)="abrirCaja()" type="button" class="btn btn-sm btn-success ms-auto me-2">Abrir Caja</button>
                            <button type="button" class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#pagos">Agregar</button>
                        </div>


                    </div>
                    <!-- CARGANDO -->
                    <div *ngIf="cargandoAgotados">
                        <div class="text-center p-4">
                            <div class="spinner-grow text-secondary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                        </div>
                        <small class="text-muted">cargando...</small>
                    </div>
                    <!-- CARGANDO -->

                    <div *ngIf="!cargandoAgotados" style="max-height: 100vh">

                        <div class="table-responsive " class="overflow-auto" style="max-height: 200px;">
                            <table class="table table-borderless table-striped table-hover table-sm animated fadeIn ">
                                <thead class="border-bottom ">
                                    <tr>
                                        <th class="text-muted " scope="col ">Descripcion</th>
                                        <th class="text-muted " scope="col ">Tipo</th>
                                        <th class="text-muted " scope="col ">Monto</th>
                                    </tr>
                                </thead>

                                <tbody>

                                    <tr class="text-danger">
                                        <td>
                                            Total de Pagos
                                        </td>
                                        <td>
                                            --
                                        </td>
                                        <td> {{ amount | currency: 'COP' }} </td>
                                    </tr>

                                    <tr class="trHover" *ngFor="let pay of alquiler.payments; let i = index">
                                        <td>
                                            <span>{{ pay.description || 'Sin descripcion' }}</span>
                                        </td>
                                        <td>{{ pay.type }}</td>
                                        <td>{{ pay.amount | currency: 'COP' }} </td>
                                    </tr>

                                </tbody>
                                <tfoot>
                                    <tr class="border-top">
                                        <td colspan="2"> <span class="fw-bold"> Restante </span></td>
                                        <td> <span class="fw-bold">{{ ( amount - totalPagos) | currency: 'COP' }}</span> </td>
                                    </tr>
                                </tfoot>

                            </table>

                        </div>

                        <!-- BTN SIGUIENTE Y ANTERIOR -->
                        <div class="row">
                            <div class="col">
                                <small class="text-muted">Total de pagos: ({{ 0}})</small>
                            </div>
                        </div>
                        <!-- BTN SIGUIENTE Y ANTERIOR -->

                    </div>
                </div>
                <!-- TABLE PAGOS-->

            </div>
            <!-- PAGOS -->

        </div>

    </ng-container>



</div>
<!-- =========================================================================
    BODY 
========================================================================= -->

<!-- =========================================================================
    MODAL Pagos 
========================================================================= -->
<div class="modal fade" id="pagos" tabindex="-1" aria-labelledby="pagosModal" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-body p-0">

                <div class="container-fluid">
                    <div class="py-2">

                        <!-- COLUMNA IZQ -->
                        <div class="col px-0 bg-white">

                            <!-- TITULO -->
                            <div class="bg-header-blue py-1 px-2">
                                <h4 class="text-white fw-normal mb-0">Pagos o Abonos</h4>
                            </div>

                            <div class="container-fluid py-4">

                                <div *ngIf="user.cerrada" class="alert alert-warning alert-dismissible fade show" role="alert">
                                    <strong>Atención:</strong> Debes de abrir caja
                                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                </div>

                                <!-- TOTAL -->
                                <div class="text-center my-3">
                                    <ng-container *ngIf="alquiler">
                                        <h4 class="display-4 text-primary">{{ amount | currency:'COP' }}</h4>
                                    </ng-container>


                                    <small *ngIf="totalPagos > 0 && totalPagos < amount" class="text-danger animated fadeIn">Resta</small>
                                    <small *ngIf="totalPagos > 0 && totalPagos >= amount" class="text-success animated fadeIn">Vueltos</small>
                                    <h4 class="mb-0 fw-normal animated fadeIn" [ngClass]=" {   'text-danger': totalPagos < amount, 'text-success': totalPagos >= amount }" *ngIf="totalPagos > 0">
                                        {{ vueltos | currency: 'COP' }}
                                    </h4>

                                </div>
                                <!-- TOTAL -->


                                <div class="d-flex justify-content-center">

                                    <div>

                                        <!-- FORM INVOICE - FORM INVOICE -->
                                        <div class="row text-center">
                                            <div class="col p-2">

                                                <input type="radio" class="btn-check" name="type" id="efectivo-outlined" value="efectivo" autocomplete="off" checked #cheT (change)="cheT.value = 'efectivo'">
                                                <label class="btn btn-outline-success" for="efectivo-outlined">
                                                    <i class="px-3 bi-cash-stack" style="font-size: 1.5rem;"></i>
                                                    <p class="mb-0">Efectivo</p>
    
                                                </label>

                                            </div>

                                            <div class="col p-2">

                                                <input type="radio" class="btn-check" name="type" id="transferencia-outlined" value="transferencia" autocomplete="off" #cheT2 (change)="cheT.value = cheT2.value">
                                                <label class="btn btn-outline-info" for="transferencia-outlined">
                                                        <i class="px-3 bi-credit-card" style="font-size: 1.5rem;"></i>
                                                        <p class="mb-0">Transferencia</p>
                                                    </label>

                                            </div>

                                            <div class="col p-2">

                                                <input type="radio" class="btn-check" name="type" id="tarjeta-outlined" value="tarjeta" autocomplete="off" #cheT3 (change)="cheT.value = cheT3.value">
                                                <label class="btn btn-outline-primary" for="tarjeta-outlined">
                                                    <i class="px-3 bi-credit-card" style="font-size: 1.5rem;"></i>
                                                    <p class="mb-0">Tarjeta</p>
                                                </label>

                                            </div>

                                            <div class="col p-2">
                                                <input type="radio" class="btn-check" name="options-outlined" name="type" id="mixto-outlined" value="mixto" autocomplete="off" #cheT4 (change)="cheT.value = cheT4.value">
                                                <label class="btn btn-outline-dark" for="mixto-outlined">
                                                    <i class="px-3 bi-patch-question" style="font-size: 1.5rem;"></i>
                                                    <p class="mb-0">Mixto</p>
                                                    </label>
                                            </div>

                                        </div>

                                        <div class="mx-auto">

                                            <!-- TABLA -->
                                            <div class="table-responsive">
                                                <table class="table table-sm table-borderless">
                                                    <thead>
                                                        <tr>
                                                            <th>#</th>
                                                            <th>Descripcion</th>
                                                            <th>Monto</th>
                                                            <th></th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>

                                                        <ng-container *ngIf="alquiler">

                                                            <tr class="trHover" *ngFor="let control of alquiler.payments; let i = index">
                                                                <th>{{ i + 1}}</th>
                                                                <td>
                                                                    <p class="mb-0">{{ control.type }} <span *ngIf="control.description">- {{ control.description }}</span></p>
                                                                </td>
                                                                <td> {{ control.amount | currency: 'COP' }} </td>
                                                                <td>
                                                                    <button type="button" class="btn btn-link p-1 text-danger text-right" (click)="eliminarPagos(i)"> <i class="bi-trash"></i> </button>
                                                                </td>
                                                            </tr>
                                                        </ng-container>


                                                    </tbody>
                                                </table>

                                            </div>
                                            <!-- TABLA -->

                                            <!-- AGREGAR METODO DE PAGO -->
                                            <div class="row g-3 d-flex justify-content-center">

                                                <div class="col-auto">
                                                    <select class="form-select" aria-label="Default select example" (change)="typeAdd.value" #typeAdd>
                                                        <option *ngIf="cheT.value === 'efectivo' || cheT.value === 'mixto' || cheT.value === 'credito'" value="efectivo">Efectivo</option>
                                                        <option *ngIf="cheT.value === 'transferencia' || cheT.value === 'mixto' || cheT.value === 'credito'" value="transferencia">Transferencia</option>
                                                        <option *ngIf="cheT.value === 'tarjeta' || cheT.value === 'mixto' || cheT.value === 'credito'" value="tarjeta">Tarjeta</option>
                                                        <ng-container *ngIf="cheT.value !== 'efectivo'">
                                                            <option *ngFor="let banco of bancos" [value]="banco.name"> {{banco.name}}</option>                                                                
                                                        </ng-container>
                                                    </select>
                                                </div>

                                                <div class="col-auto">
                                                    <label for="Descripción" class="visually-hidden">Descripción</label>
                                                    <input type="text" class="form-control w100" id="Descripción" placeholder="Descripción" (keyup)="descripcionAdd.value" #descripcionAdd>
                                                </div>

                                                <div class="col-auto">
                                                    <label for="monto" class="visually-hidden">Monto</label>

                                                    <ng-container>
                                                        <input type="number" class="form-control" [value]="vueltos" id="monto" placeholder="Monto" autofocus="true" (keyup)="montoAdd.value = montoAdd.value" #montoAdd>
                                                    </ng-container>

                                                </div>

                                                <!-- BTN CREAR FACTURA -->
                                                <div class="my-4 float-end">
                                                    <button type="button" (click)="agregarPagos(typeAdd.value, montoAdd.value)" class="btn btn-outline-primary">

                                                                Guardar
                                                    </button>
                                                </div>



                                            </div>
                                            <!-- AGREGAR METODO DE PAGO -->

                                        </div>
                                        <!-- FORM INVOICE - FORM INVOICE -->

                                    </div>

                                </div>
                            </div>


                        </div>
                        <!-- COLUMNA IZQ -->


                    </div>

                </div>

            </div>
        </div>
    </div>
</div>
<!-- =========================================================================
    MODAL FACTURAR 
========================================================================= -->

<!-- =========================================================================
    FACTURAR
========================================================================= -->
<div class="modal fade" id="facturarAlquiler" tabindex="-1" aria-labelledby="facturarAlquilerModal" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="facturarAlquilerModal"><i class="bi-collection" style="font-size: 1rem"></i> Facturar Alquiler</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">

                <div>

                    <!-- TOTALES -->
                    <div class="text-center">
                        <p class="mb-0">Total</p>
                        <h3 class="mb-2 display-4 text-primary"> {{ amount | currency:'COP' }} </h3>

                        <h5 *ngIf="(totalPagos + (pago.value * 1)) < amount" class="text-danger">Faltante: {{ totalPagos - amount | currency:'COP' }} </h5>
                        <h5 *ngIf="(totalPagos + (pago.value * 1)) > amount" class="text-success">Vueltos: {{ (totalPagos + (pago.value * 1 )) - amount | currency:'COP' }} </h5>

                    </div>

                    <div class="mb-3">
                        <label for="pago" class="form-label"> Restante </label>
                        <input (keyup)="pago.value" #pago type="number" class="form-control" id="pago">
                    </div>

                    <label class="form-label"> Forma de pago </label>
                    <select #typePay class="form-select mb-3" aria-label="Default select example">
                        <option value="efectivo"> Efectivo </option>
                        <option *ngFor="let banco of bancos" [value]="banco.name"> {{banco.name}}</option>
                    </select>

                    <label class="form-label"> Seleccionar Ticket </label>
                    <select #sMesa class="form-select" aria-label="Default select example">
                        <option value="" *ngIf="totalMesas.length === 0"> No tienes tickets Disponibles </option>
                        <ng-container *ngFor="let mesa of totalMesas">
                            <option [value]="mesa" *ngIf="mesa.disponible"> {{ mesa.name }} </option>
                        </ng-container>
                    </select>

                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="lqCont" #liqCont>
                        <label class="form-check-label" for="lqCont">
                        Liquidar y Continuar
                      </label>
                    </div>

                </div>

                <div class="d-flex justify-content-end gap-2">
                    <!-- BTN CREAR FACTURA -->
                    <div class="my-4 float-end">
                        <button type="button" [disabled]="facturando == true" (click)="crearFactura(false, sMesa.value, pago.value, typePay.value, liqCont.checked)" class="btn btn-outline-primary">
                        Crear Factura Pos
                    </button>
                    </div>
                    <!-- BTN CREAR FACTURA -->

                    <!-- BTN CREAR FACTURA -->
                    <div class="my-4 float-end" *ngIf="empresa?.electronica">
                        <button type="button" [disabled]="facturando == true" (click)="crearFactura(true, sMesa.value, pago.value, typePay.value, liqCont.checked)" class="btn btn-outline-success">
                        Crear Factura Electronica
                    </button>
                    </div>
                    <!-- BTN CREAR FACTURA -->
                </div>

                <div class="d-flex justify-content-center">
                    <div class="card border-0 pb-4" style="width: 14rem; color:black; background: white;" id="printDiv2" *ngIf="factura">

                        <!-- EMPRESA -->
                        <div class="card-body px-1 mb-2" style="border-bottom: 2px solid black;" *ngIf="empresa">

                            <div class="col-10 mx-auto">
                                <img *ngIf="empresa.logo" [src]="empresa.logo | imagen:'logo'" class="mx-auto" width="200px" alt="">
                            </div>

                            <h4 class="card-title mb-0 text-wrap text-center"> {{ empresa.name }} </h4>
                            <p class="mb-0 text-wrap fw-bolder text-center lh-sm" *ngIf="empresa.nit">{{ empresa.nit }}</p>
                            <p class="mb-0 text-center text-wrap" style="font-size: 0.7rem;"> </p>
                            <p class="mb-0 text-wrap text-center" *ngIf="empresa.address">{{ empresa.address }}</p>
                            <p class="mb-0 text-wrap text-center" *ngIf="empresa.phone">{{ empresa.phone }}</p>

                            <p *ngIf="!empresa.impuesto" class="mb-0 text-wrap text-center" style="font-size: 0.7rem;">No responsable de IVA</p>

                            <!-- RESPONSABLE DE IVA O IMPUESTO AL CONSUMO -->
                            <p *ngIf="empresa.impuesto && empresa.responsable" class="mb-0 text-wrap text-center" style="font-size: 0.7rem;">Responsable de iva</p>
                            <p *ngIf="empresa.impuesto && empresa.impuestoconsumo" class="mb-0 text-wrap text-center" style="font-size: 0.7rem;">Responsable nacional al consumo</p>
                            <p *ngIf="empresa.impuesto" class="mb-0 text-wrap text-center" style="font-size: 0.7rem;">Resolución: {{ empresa.resolucion }}</p>
                            <p *ngIf="empresa.impuesto" class="mb-1 text-wrap text-center" style="font-size: 0.7rem;">Prefijo Pos: {{ empresa.prefijopos }}</p>
                            <!-- RESPONSABLE DE IVA O IMPUESTO AL CONSUMO -->

                        </div>
                        <!-- EMPRESA -->

                        <!-- CLIENTE -->
                        <div class="pb-2" style="border-bottom: 2px solid black;">
                            <h6 class="mb-0 text-wrap text-left">
                                CLIENTE / RAZON SOCIAL <br>
                                <small *ngIf="factura.client" class="text-wrap fw-normal"> {{ factura.client.name }} </small>
                                <small *ngIf="!factura.client" class="text-wrap fw-normal"> ocasional </small>
                            </h6>

                            <h6 class="mb-0 text-wrap text-left">
                                CC / NIT <br>
                                <small *ngIf="factura.client" class="text-wrap fw-normal"> {{ factura.client.cedula }} </small>
                                <small *ngIf="!factura.client" class="text-wrap fw-normal"> 00000000 </small>
                            </h6>
                            <h6 class="mb-0 text-wrap text-left">
                                TELEFONO <br>
                                <small *ngIf="factura.client" class="text-wrap fw-normal"> {{ factura.client.phone }} </small>
                            </h6>
                            <h6 class="mb-0 text-wrap text-left" *ngIf="factura.client">
                                DIRECCIÓN <br>
                                <small *ngIf="factura.client" class="text-wrap fw-normal"> {{ factura.client.address || '----------'}} </small>
                            </h6>

                            <h6 class="mb-0 text-wrap text-left">
                                <p class="text-wrap fw-normal mb-0"> {{ factura.mesa.name }} - {{ factura.mesero.name }} </p>
                            </h6>
                        </div>
                        <!-- CLIENTE -->

                        <!-- FACTURA -->
                        <div class="py-2" style="border-bottom: 2px solid black;">
                            <h6 class="mb-0 text-wrap text-left">Factura de venta pos: {{ factura.invoice }}</h6>
                            <h6 class="mb-0 text-wrap text-left">Control: {{ factura?.control }}</h6>
                            <small class="mb-0 text-wrap text-left">Fecha: {{ factura.fecha | date:'short' }}</small>
                        </div>
                        <!-- FACTURA -->

                        <table class="table table-borderless table-hover table-sm">
                            <tbody style="color: black;">
                                <tr *ngFor="let item of factura.products" class="trHover">
                                    <td>
                                        <small class="text-wrap"> {{ item.qty }} x {{item.price | divisa}} </small> <br>
                                        <small class="text-wrap"> {{ item.product.name }} </small>
                                    </td>
                                    <td> <small class="text-wrap"> {{ item.qty * item.price | divisa }} </small> </td>
                                </tr>
                                <tr class="" style="border-top: 2px solid black;">
                                    <td>
                                        <h6 class="mb-0 text-wrap text-left">Sub-total</h6>
                                    </td>
                                    <td class="fw-bold">
                                        <h6 class="mb-0 text-wrap text-rigth"> {{ factura.base | divisa }} </h6>
                                    </td>
                                </tr>

                                <!-- DESCUENTO -->
                                <tr class="" style="border-top: 2px solid black;">
                                    <td>
                                        <h6 class="mb-0 text-wrap text-left">Descuento</h6>
                                    </td>
                                    <td class="fw-bold">
                                        <h6 class="mb-0 text-wrap text-rigth" *ngIf="factura.descuento"> {{ (factura.base * factura.porcentaje )/100 | divisa }} </h6>
                                    </td>
                                </tr>


                                <!-- <p class="h6 fw-normal text-primary mb-0">Sub-total {{ base | divisa }}</p>

                                <ng-container *ngFor="let impuesto of impuestos">
                                    <p class="h6 fw-normal text-primary mb-0" *ngIf="impuesto.total > 0"> {{ impuesto.name }} {{ impuesto.total | divisa }}</p>
                                </ng-container>

                                <p class="h6 fw-normal text-danger mb-0" *ngIf="mesa?.descuento">Descuento {{ (base * mesa?.porcentaje) / 100 | divisa }}</p>
                                <h4 class="fw-normal text-primary" *ngIf="empresa.impuesto">{{ total | divisa }}</h4> -->
                                <ng-container *ngIf="!empresa.impuesto">
                                    <tr class="" style="border-top: 2px solid black;">
                                        <td>
                                            <h6 *ngIf="!empresa.impuestos" class="mb-0 text-wrap text-left">No responsable de IVA</h6>
                                        </td>
                                        <td class="fw-bold">
                                            <h6 class="mb-0 text-wrap text-rigth"> 0 </h6>
                                        </td>
                                    </tr>
                                </ng-container>

                                <ng-container *ngIf="empresa.impuesto">
                                    <ng-container *ngFor="let impuesto of impuestos">

                                        <tr *ngIf="impuesto.total > 0" class="" style="border-top: 2px solid black;">
                                            <td>
                                                <h6 class="mb-0 text-wrap text-left"> {{ impuesto.name }} </h6>

                                            </td>
                                            <td class="fw-bold">
                                                <h6 class="mb-0 text-wrap text-rigth"> {{ impuesto.total | divisa }} </h6>
                                            </td>
                                        </tr>
                                    </ng-container>
                                </ng-container>

                                <tr class="" style="border-top: 2px solid black;">
                                    <td>
                                        <h6 class="mb-0 text-wrap text-left">Total</h6>
                                    </td>
                                    <td class="fw-bold">
                                        <h6 class="mb-0 text-wrap text-rigth"> {{ factura.amount | divisa}} </h6>
                                    </td>
                                </tr>

                                <tr class="" style="border-top: 2px solid black;" *ngIf="empresa.tip">
                                    <td>
                                        <h6 class="mb-0 text-wrap text-left">Propina Sugerida del {{empresa.propina}}%</h6>
                                    </td>
                                    <td class="fw-bold">
                                        <h6 class="mb-0 text-wrap text-rigth"> {{ (factura.amount * empresa.propina)/100 | divisa }} </h6>
                                    </td>
                                </tr>
                                <tr class="" style="border-top: 2px solid black;" *ngIf="empresa.tip">
                                    <td>
                                        <h6 class="mb-0 text-wrap text-left">Total + Propina</h6>
                                    </td>
                                    <td class="fw-bold">
                                        <h6 *ngIf="empresa.responsable" class="mb-0 text-wrap text-rigth"> {{ factura.amount+ (factura.amount * empresa.propina)/100 + (factura.amount * empresa.tax)/100 | divisa}} </h6>
                                        <h6 *ngIf="!empresa.responsable" class="mb-0 text-wrap text-rigth"> {{ factura.amount + (factura.amount * empresa.propina)/100 | divisa }} </h6>
                                    </td>
                                </tr>

                            </tbody>
                        </table>

                        <hr class="my-1">
                        <div *ngIf="!factura.apartado">
                            <p class="mb-0 mx-auto"><small class="text-wrap text-center mb-0">Pago con: {{factura.pago | divisa}} </small></p>
                            <p class="mb-0 mx-auto"><small class="text-wrap text-center mb-0">Vueltos: {{factura.vueltos | divisa}} </small></p>
                        </div>

                        <div *ngIf="factura.apartado">
                            <h6 class="mb-2 fw-bold">Historial de pagos</h6>
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th scope="col">Desc</th>
                                        <th scope="col">Pago</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr *ngFor="let pay of factura.payments">
                                        <td>Abono {{ pay.type }} </td>
                                        <td> {{ pay.amount | divisa }} </td>
                                    </tr>

                                </tbody>
                                <tfoot>
                                    <tr>
                                        <th>Restante</th>
                                        <th> {{ factura.amount - totalPagos | divisa }} </th>
                                    </tr>
                                </tfoot>
                            </table>

                        </div>

                        <hr class="my-1">
                        <h6 *ngIf="factura.nota" class="mb-0">Nota:</h6>
                        <p *ngIf="factura.nota" class="">- {{ factura.nota }} </p>


                        <hr *ngIf="factura.nota" class="my-1">

                        <h5 class="text-center"> GRACIAS POR SU COMPRA </h5>
                        <small class="text-wrap text-center mb-0"> Factura impresa por SIMIDS </small>
                        <small class="text-wrap text-center mb-0" style="font-size: 0.7rem;">(Nataly Castillo)</small>
                        <small class="text-wrap text-center mb-0">NIT. 1090502421-0</small>


                    </div>
                </div>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
            </div>
        </div>
    </div>
</div>
<!-- =========================================================================
    FACTURAR
========================================================================= -->