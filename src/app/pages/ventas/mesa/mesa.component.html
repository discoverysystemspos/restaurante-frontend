<!-- =========================================================================
    TICKET 1 
========================================================================= -->
<div class="container-fluid mb-5">

    <div class="row">

        <div class="col-md-8 align-self-start animated fadeIn mb-5" *ngIf="menu">

            <!-- BOTONES -->
            <div class="d-flex flex-wrap gap-2 my-2">

                <button *ngIf="this.user.cerrada" [disabled]="user.role === 'WAITERALL' || user.role === 'WAITER'" (click)="abrirCaja()" class="btn btn-success btn-sm" type="button">Abrir caja</button>
                <button *ngIf="!this.user.cerrada" [disabled]="user.role === 'WAITERALL' || user.role === 'WAITER'" [routerLink]="['/dashboard', 'corte']" class="btn btn-secondary btn-sm" type="button">Cerrar caja</button>

                <button *ngIf="user.role !== 'WAITERALL' && user.role !== 'WAITER'" #btnCreateClient type="button" class="btn btn-outline-success btn-sm" data-bs-toggle="modal" data-bs-target="#buscarCliente"><i class="bi-people"></i> Crear Cliente </button>

                <!-- <button type="button" class="btn btn-outline-primary btn-sm" data-bs-toggle="collapse" href="#productsColl" role="button" aria-expanded="false" aria-controls="collapseExample"><i class="bi-box"></i> Productos </button> -->
                <button *ngIf="user.role !== 'WAITERALL' && user.role !== 'WAITER'" type="button" class="btn btn-outline-primary btn-sm" data-bs-toggle="modal" data-bs-target="#buscarProducto"><i class="bi-box"></i> Nuevo Codigo </button>

                <button *ngIf="user.role !== 'WAITERALL' && user.role !== 'WAITER'" type="button" class="btn btn-outline-primary btn-sm" data-bs-toggle="modal" data-bs-target="#entradaSalidas"><i class="bi-arrow-left-right"></i> Entradas y Salidas </button>
                <button type="button" (click)="scrollToBottom()" (click)="timeCommand()" class="btn btn-outline-info btn-sm" data-bs-toggle="modal" data-bs-target="#comandas"><i class="bi-receipt"></i> Comandas </button>
                <button type="button" *ngIf="mesa?.img === 'mesa.svg'" (click)="cargarMesasAll()" class="btn btn-outline-dark btn-sm" data-bs-toggle="modal" data-bs-target="#cambiarMesa"><i class="bi-arrow-repeat"></i> Cambiar Mesa </button>
                <button *ngIf="user.role !== 'WAITERALL' && user.role !== 'WAITER'" type="button" class="btn btn-outline-warning btn-sm" data-bs-toggle="modal" data-bs-target="#descuentoModal"><i class="bi-percent"></i> Descuento </button>
                <a *ngIf="user.role !== 'WAITERALL' && user.role !== 'WAITER'" [routerLink]="['/', 'dashboard', 'productos', 'kardex']" class="btn btn-outline-primary btn-sm"><i class="bi-box"></i> Kardex </a>
                <button *ngIf="user.role !== 'WAITERALL' && user.role !== 'WAITER'" (click)="mayoreoChange()" type="button" class="btn btn-outline-dark btn-sm"><i class="bi-arrow-down-up"></i> Mayoreo </button>
                <button (click)="changeMenu(menu)" type="button" class="btn btn-outline-primary">
                    <i *ngIf="!menu" class="bi bi-grid"></i>
                    <i *ngIf="menu" class="bi bi-justify"></i>
                </button>

            </div>

            <hr>

            <!-- <div class="p-2 border-bottom my-2 d-flex flex-wrap justify-content-start gap-2"> -->
            <div id="dd" class="p-2 my-2 d-flex flex-wrap justify-content-start gap-2" style="max-height: 105px; overflow-y: scroll;">

                <!-- <div class="p-2">

                        <button type="button" (click)="cargarProductos()" class="btn bg-white btnW waves-effect waves-blue text-muted"> 
                            <i class="bi-grid-3x3-gap" style="font-size:2rem;"></i> 
                            <h5>Todos</h5>
                        </button>

                    </div> -->

                <ng-container *ngFor="let departamento of departmentos">

                    <div *ngIf="departamento.visibility && departamento.status">

                        <button style="width: auto;" type="button" (click)="cargarProductosDepartamento(departamento.did)" class="btn bg-white p-0 m-0 btnW waves-effect waves-blue text-muted d-flex align-items-center"> 
                            <img style="width: 1.5rem; height: 1.5rem; object-fit: cover; " [src]="departamento.img | imagen:'department'" alt="...">
                            <p class="mb-0 mx-1" style="font-size: 0.9rem">{{ departamento.name }}</p>
                        </button>

                    </div>

                </ng-container>


            </div>
            <!-- DEPARTAMENTOS -->

            <hr>

            <!-- PRODUCTOS -->
            <div class="d-flex justify-content-center flex-wrap mb-5">

                <div *ngIf="listaProductos.length < 1" class="py-4">
                    <h4 class="text-muted">Sin Resultados</h4>
                </div>

                <ng-container *ngFor="let producto of listaProductos">

                    <div class="card m-1 animated fadeIn" style="width: 12rem;" *ngIf="producto.visibility && producto.status">
                        <div class="position-absolute ms-2 mt-2">
                            <span *ngIf="producto.inventario <= producto.min && producto.type !== 'Paquete' && producto.inventario > 0" class="badge rounded-pill bg-warning text-dark">Bajo</span>
                            <span *ngIf="producto.inventario <= 0 && producto.type !== 'Paquete'" class="badge rounded-pill bg-danger">Agotado</span>
                            <span *ngIf="producto.vencido" class="badge rounded-pill bg-warning">Vencido</span>
                        </div>

                        <img class="avatar-xxl avatar-img avatar-redondo-lg mx-auto" style="height: 180px; width: auto;" [src]="producto.img | imagen:'products'" class="card-img-top" alt="...">

                        <div class="card-body py-2 d-flex align-items-start flex-column">

                            <div>
                                <p class="mb-0">cant. {{ producto.inventario | number }}</p>
                                <h5 class="card-title mb-1">{{ producto.name }}</h5>
                            </div>
                            <div class="col-12 mt-auto">
                                <div class="d-flex align-items-center">

                                    <p class="mb-0 text-success">{{ producto.price | divisa }}</p>
                                    <button *ngIf="!empresa.kiosco" type="button" [disabled]=" producto.vencido || producto.inventario <= 0 && producto.type !== 'Paquete'" (click)="buscarCodigo( producto.code )" class="btn btn-link btn-primary text-white ms-auto" style="font-size: 1rem;">
                                        <i class="bi bi-cart-plus"></i>
                                    </button>
                                    <button *ngIf="empresa.kiosco" type="button" [disabled]=" producto.vencido || producto.inventario <= 0 && producto.type !== 'Paquete'" (click)="modalProducto(producto)" class="btn btn-link btn-primary text-white ms-auto" style="font-size: 1rem;">
                                        <i class="bi bi-cart-plus"></i>
                                    </button>

                                </div>
                            </div>
                        </div>

                    </div>

                </ng-container>


            </div>
            <!-- PRODUCTOS -->

        </div>

        <div class="col-md-8 align-self-start animated fadeIn" *ngIf="!menu">

            <!-- BOTONES -->
            <div class="d-flex flex-wrap gap-2 my-2">

                <button *ngIf="this.user.cerrada" (click)="abrirCaja()" class="btn btn-success btn-sm" type="button">Abrir caja</button>
                <button *ngIf="!this.user.cerrada" [routerLink]="['/dashboard', 'corte']" class="btn btn-secondary btn-sm" type="button">Cerrar caja</button>

                <button *ngIf="user.role !== 'WAITERALL' && user.role !== 'WAITER'" type="button" class="btn btn-outline-success btn-sm" data-bs-toggle="modal" data-bs-target="#buscarCliente"><i class="bi-people"></i> Crear Cliente </button>

                <!-- <button *ngIf="user.role !== 'WAITERALL' && user.role !== 'WAITER'"  type="button" class="btn btn-outline-primary btn-sm" data-bs-toggle="collapse" href="#productsColl" role="button" aria-expanded="false" aria-controls="collapseExample"><i class="bi-box"></i> Productos </button> -->
                <button *ngIf="user.role !== 'WAITERALL' && user.role !== 'WAITER'" type="button" class="btn btn-outline-primary btn-sm" data-bs-toggle="modal" data-bs-target="#buscarProducto"><i class="bi-box"></i> Nuevo Codigo </button>

                <button *ngIf="user.role !== 'WAITERALL' && user.role !== 'WAITER'" type="button" class="btn btn-outline-primary btn-sm" data-bs-toggle="modal" data-bs-target="#entradaSalidas"><i class="bi-arrow-left-right"></i> Entradas y Salidas </button>
                <button type="button" (click)="scrollToBottom()" (click)="timeCommand()" class="btn btn-outline-info btn-sm" data-bs-toggle="modal" data-bs-target="#comandas"><i class="bi-receipt"></i> Comandas </button>
                <button type="button" *ngIf="mesa?.img === 'mesa.svg'" (click)="cargarMesasAll()" class="btn btn-outline-dark btn-sm" data-bs-toggle="modal" data-bs-target="#cambiarMesa"><i class="bi-arrow-repeat"></i> Cambiar Mesa </button>
                <button *ngIf="user.role !== 'WAITERALL' && user.role !== 'WAITER'" type="button" class="btn btn-outline-warning btn-sm" data-bs-toggle="modal" data-bs-target="#descuentoModal"><i class="bi-percent"></i> Descuento </button>
                <a *ngIf="user.role !== 'WAITERALL' && user.role !== 'WAITER'" [routerLink]="['/', 'dashboard', 'productos', 'kardex']" class="btn btn-outline-primary btn-sm"><i class="bi-box"></i> Kardex </a>
                <button *ngIf="user.role !== 'WAITERALL' && user.role !== 'WAITER'" (click)="mayoreoChange()" type="button" class="btn btn-outline-dark btn-sm"><i class="bi-arrow-down-up"></i> Mayoreo </button>
                <button (click)="changeMenu(menu)" type="button" class="btn btn-outline-primary">
                    <i *ngIf="!menu" class="bi bi-grid"></i>
                    <i *ngIf="menu" class="bi bi-justify"></i>
                </button>
            </div>

            <hr>

            <div class="card py-4 mt-3">

                <!-- SEARCH PRODUCT CODE -->
                <div>
                    <div class="col-12 d-flex justify-content-between">
                        <div class="form-row w-100">
                            <div class="col-md-6 mt-2">

                                <input type="text" class="form-control" placeholder="Ingrese o busca un codigo de barras" (keyup.enter)="buscarCodigo(searchCode.value)" #searchCode>
                                <p class="mb-0 text-info fadeIn" *ngIf="inventarioNewB"> Stock: {{ inventarioNew | number }} </p>
                            </div>

                            <div class="col-md-6 mt-2">

                                <input type="text" class="form-control" placeholder="buscar producto" (keyup)="buscarProducto(searchProduct.value)" #searchProduct>

                                <div *ngIf="listaProductos.length > 0 && searchProduct.value.length !== 0" class="bg-white px-2 shadow col-auto" style="position: absolute; z-index: 1020;">

                                    <ul class="list-group list-group-flush overflow-auto" style="max-height: 150px;">

                                        <li class="list-group-item py-1">
                                            <h6>Resultados: ({{ listaProductos.length }})</h6>
                                        </li>

                                        <li class="list-group-item py-1" *ngFor="let item of listaProductos">
                                            <button [disabled]="item.inventario <= 0 && item.type !== 'Paquete' || !item.status" class="border-0 bg-white w-100 text-start" (click)="modalProducto(item); searchProduct.value = '' " type="button">
                                                    <div class="d-flex">
                                                        <div class="align-self-center">
                                                            <span> {{ item.name }} </span>
                                                            <span *ngIf="!item.status" class="badge rounded-pill bg-danger">Eliminado</span>
                                                            <span *ngIf="item.inventario <= 0 && item.type !== 'Paquete'" class="badge rounded-pill bg-danger">Agotado</span>
                                                            <span *ngIf="item.inventario > 0 && item.inventario <= item.min &&  item.type !== 'Paquete'" class="badge rounded-pill bg-warning text-dark">Bajo</span>
                                                        </div>
                                                        
                                                        <div class="ms-auto">
                                                            <span *ngIf="!item.out" class="btn btn-link p-1 text-success float-end" > 
                                                                <i class="bi-arrow-90deg-right"></i>
                                                            </span>
                                                        </div>
                                                    </div>
                                                </button>
                                        </li>

                                    </ul>

                                </div>
                            </div>

                        </div>
                    </div>
                </div>
                <!-- SEARCH PRODUCT CODE -->

                <hr class="my-2">

                <div class="table-responsive">
                    <table class="table table-borderless table-striped table-hover table-sm animated fadeIn ">
                        <thead class="border-bottom ">
                            <tr>
                                <th class="text-muted text-left" scope="col " colspan="2 ">Descripción</th>
                                <th class="text-muted " scope="col ">Precio</th>
                                <th class="text-muted " scope="col ">Cantidad</th>
                                <th class="text-muted " scope="col ">Monto</th>
                                <th class="text-muted " scope="col "></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngIf="carrito.length === 0" class="text-center ">
                                <th colspan="10" class="py-4">
                                    <h4 class="text-muted">No has seleccionado ningun producto</h4>
                                </th>
                            </tr>

                            <ng-container *ngIf="carrito.length > 0 ">
                                <ng-container *ngFor="let item of carrito; let i = index">
                                    <tr class="trHover" *ngIf="item.product" [ngClass]="{'table-success': item.mayor}">
                                        <td colspan="2">
                                            <div>
                                                <p class="mb-0">{{ item.product.name }}<span *ngIf="item.mayor" class="badge text-dark">M</span></p>
                                            </div>
                                        </td>
                                        <td>{{ item.price | divisa }}</td>
                                        <td class="text-center">
                                            <button *ngIf="empresa.bascula" type="button" (click)="loadBascula(i, item)" class="btn btn-link p-1 text-primary">
                                                <i class="bi-arrow-down-square-fill" style="font-size: 1rem"></i>
                                            </button>
                                            <input [readonly]="user.role === 'WAITER' || user.role === 'WAITERALL'" class="w-75" min="1" type="number" [value]="item.qty" (change)="changeCant(cantt.value, item)" #cantt>
                                        </td>
                                        <td>{{ item.price * item.qty | divisa}}</td>
                                        <td>
                                            <button type="button" [disabled]="user.role !== 'ADMIN' && user.role !== 'STAFF' && user.role !== 'CASHIER'" (click)="eliminarProductoCarrito(i, item.product)" class="btn btn-link p-1 text-danger"><i class="bi-trash" style="font-size: 0.9rem"></i></button>
                                        </td>
                                    </tr>
                                </ng-container>

                            </ng-container>

                        </tbody>
                    </table>
                </div>

            </div>

        </div>

        <div class="col-md-4 bg-white py-4 px-2 border-start" style="min-height: 100vh;">

            <div class="d-grid">

                <div class="mb-3">

                    <div class="mb-3">
                        <input type="text" class="form-control" placeholder="buscar cliente" (keyup)="buscarCliente(searchClient.value)" #searchClient>
                    </div>

                    <div *ngIf="listaClientes.length > 0" class="bg-white py-3 px-2 shadow" style="position: absolute; z-index: 1020;">

                        <div *ngIf="cargandoCliente" class="text-center py-3">
                            <div class="spinner-grow text-secondary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <div>
                                <small class="text-muted">Cargando...</small>
                            </div>
                        </div>

                        <ul *ngIf="!cargandoCliente" class="list-group list-group-flush overflow-auto" style="max-height: 200px; min-width: 250px;">

                            <li class="list-group-item">
                                <h6>Resultados: ({{ listaClientes.length }})</h6>
                            </li>

                            <li class="list-group-item" *ngFor="let item of listaClientes">
                                <div class="d-flex ">
                                    <div class="align-self-center">
                                        <span class="text-capitalize fw-bold"> {{ item.name }} </span><br>
                                        <small> C.C: {{ item.cedula }} </small>
                                    </div>

                                    <div class="ms-auto">
                                        <button class="btn btn-link p-1 text-success float-end" (click)="seleccionarCliente(item)"> <i class="bi-arrow-90deg-right"></i></button>
                                    </div>
                                </div>

                            </li>
                        </ul>

                    </div>

                    <ng-container *ngIf="empresa">
                        <div *ngIf="empresa.taller">

                            <input type="text" class="form-control" placeholder="buscar Vehiculo" (keyup)="buscarV(searchV.value)" #searchV>

                            <div *ngIf="vehiculos.length > 0 && searchV.value.length !== 0" class="bg-white px-2 shadow col-auto" style="position: absolute; z-index: 1020;">

                                <ul class="list-group list-group-flush overflow-auto" style="max-height: 150px;">

                                    <li class="list-group-item py-1">
                                        <h6>Resultados: ({{ vehiculos.length }})</h6>
                                    </li>

                                    <li class="list-group-item py-1" *ngFor="let vehiculo of vehiculos">
                                        <button [disabled]="!vehiculo.status" class="border-0 bg-white w-100 text-start" (click)="selectV(vehiculo)" type="button">
                                            <div class="d-flex">
                                                <div class="align-self-center">
                                                    <span> {{ vehiculo.placa }} </span>
                                                    <span> {{ vehiculo.model }} </span>
                                                    <span> {{ vehiculo.client.name }} </span>
                                                    <span *ngIf="!vehiculo.status" class="badge rounded-pill bg-danger">Eliminado</span>
                                                </div>
                                            </div>
                                        </button>
                                    </li>

                                </ul>

                            </div>


                            <button type="button" class="btn btn-sm btn-outline-info mt-3" data-bs-toggle="modal" data-bs-target="#imgUp">Subir Fotos</button>
                        </div>


                    </ng-container>


                </div>

            </div>
            <!-- BUSCAR CLIENTE -->

            <div>

                <div *ngIf="menu" class="animated fadeIn">

                    <hr class="my-2">

                    <!-- SEARCH PRODUCT CODE -->
                    <div>
                        <input type="text" class="form-control" placeholder="Ingrese o busca un codigo de barras" (keyup.enter)="buscarCodigo(searchCode.value)" #searchCode>
                        <p class="mb-0 text-info fadeIn" *ngIf="inventarioNewB"> Stock: {{ inventarioNew | number }} </p>
                    </div>
                    <!-- SEARCH PRODUCT CODE -->

                    <hr class="my-2">

                    <div>
                        <input type="text" class="form-control" placeholder="buscar producto" (keyup)="buscarProducto(searchProduct.value)" #searchProduct>
                    </div>

                    <div *ngIf="listaProductos.length > 0 && searchProduct.value.length !== 0" class="bg-white px-2 shadow col-auto" style="position: absolute; z-index: 1020;">

                        <ul class="list-group list-group-flush overflow-auto" style="max-height: 150px;">

                            <li class="list-group-item py-1">
                                <h6>Resultados: ({{ listaProductos.length }})</h6>
                            </li>

                            <li class="list-group-item py-1" *ngFor="let item of listaProductos">
                                <button [disabled]="item.status === false || item.inventario <= 0 && item.type !== 'Paquete' " class="border-0 bg-white w-100 text-start" (click)="modalProducto(item); searchProduct.value = '' " type="button">
                                    <div class="d-flex">
                                        <div class="align-self-center">
                                            <span> {{ item.name }} </span>
                                            <span *ngIf="!item.status" class="badge rounded-pill bg-danger">Eliminado</span>
                                            <span *ngIf="item.status && item.inventario <= 0 && item.type !== 'Paquete'" class="badge rounded-pill bg-danger">Agotado</span>
                                            <span *ngIf="item.status && item.inventario > 0 && item.inventario <= item.min &&  item.type !== 'Paquete'" class="badge rounded-pill bg-warning text-dark">Bajo</span>
                                        </div>
                                        
                                        <div class="ms-auto">
                                            <span *ngIf="!item.out" class="btn btn-link p-1 text-success float-end" > 
                                                <i class="bi-arrow-90deg-right"></i>
                                            </span>
                                        </div>
                                    </div>
                                </button>
                            </li>

                        </ul>

                    </div>

                    <hr class="my-2">

                    <div class="table-responsive">
                        <table class="table table-borderless table-striped table-hover table-sm animated fadeIn ">
                            <thead class="border-bottom ">
                                <tr>
                                    <th class="text-muted text-left" scope="col " colspan="2 ">Descripción</th>
                                    <th class="text-muted " scope="col ">Precio</th>
                                    <th class="text-muted " scope="col ">Cantidad</th>
                                    <th class="text-muted " scope="col ">Monto</th>
                                    <th class="text-muted " scope="col "></th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngIf="carrito.length === 0" class="text-center ">
                                    <th colspan="10" class="py-4">
                                        <h4 class="text-muted">No has seleccionado ningun producto</h4>
                                    </th>
                                </tr>

                                <ng-container *ngIf="carrito.length > 0 ">

                                    <ng-container *ngFor="let item of carrito; let i = index">
                                        <tr class="trHover" *ngIf="item.product" [ngClass]="{'table-success': item.mayor}">
                                            <td colspan="2">
                                                <p class="mb-0">{{ item.product.name }} <span *ngIf="item.mayor" class="badge text-dark">M</span></p>
                                            </td>
                                            <td>{{ item.price | divisa}}</td>
                                            <td class="text-center">
                                                <input [readonly]="inputChange || user.role === 'WAITER' || user.role === 'WAITERALL'" class="w-75" min="1" type="number" [value]="item.qty" [max]="item.product.inventario" (change)="changeCant(cant.value, item)" #cant>
                                            </td>
                                            <td>{{ item.price * item.qty | divisa}}</td>
                                            <td>
                                                <button type="button" [disabled]="user.role !== 'ADMIN' && user.role !== 'STAFF' && user.role !== 'CASHIER'" (click)="eliminarProductoCarrito(i, item.product)" class="btn btn-link p-1 text-danger"><i class="bi-trash" style="font-size: 0.9rem"></i></button>
                                            </td>
                                        </tr>
                                    </ng-container>

                                </ng-container>

                            </tbody>
                            <tfoot>
                                <th colspan="5">ITEMS</th>
                                <th> {{ totalItems | number }} </th>
                            </tfoot>
                        </table>
                    </div>

                </div>

                <!-- TOTALES -->

                <hr>

                <div class="container-fluid">
                    <div class="">

                        <!-- COLUMNA IZQ -->
                        <div class="col px-0 bg-white">

                            <div class="container-fluid">

                                <ng-container *ngIf="empresa?.min && empresa.electronica">
                                    <div *ngIf="total >= empresa.min" class="alert alert-warning fade show" role="alert">
                                        <strong>Atención:</strong> Para montos mayores a <strong>{{ empresa.min | number }}</strong> se debe crear factura electronica
                                    </div>
                                </ng-container>

                                <div class="d-flex justify-content-center">

                                    <div>

                                        <!-- FORM INVOICE - FORM INVOICE -->
                                        <form autocomplete="off" [formGroup]="invoiceForm">

                                            <!-- <div class="col-auto">
                                                <label for="fecha" class="">Fecha</label>
                                                <input type="datetime-local" formControlName="fecha" class="form-control" id="fecha" placeholder="Selecciona una fecha limite" #fechCredito>
                                            </div> -->

                                            <div class="mx-auto my-3" *ngIf="empresa?.marca">

                                                <div class="form-check">
                                                    <input formControlName="marca" class="form-check-input" type="checkbox" value="" id="marcaCheck">

                                                    <label class="form-check-label h5" for="marcaCheck">
                                                        Marca de Pagado
                                                    </label>
                                                </div>

                                            </div>

                                            <div class="d-flex flex-wrap gap-2 justify-content-center">
                                                <div class="">

                                                    <input type="radio" (click)="limpiarPagos()" class="btn-check" name="type" formControlName="type" id="efectivo-outlined" value="efectivo" autocomplete="off" checked>
                                                    <label class="btn btn-outline-success" for="efectivo-outlined">
                                                        <i class="px-2 bi-cash-stack" style="font-size: 1rem;"></i>
                                                        <p class="mb-0" style="font-size: 0.9rem;" >Efectivo</p>        
                                                    </label>

                                                </div>

                                                <div class="">

                                                    <input type="radio" (click)="limpiarPagos()" class="btn-check" name="type" formControlName="type" id="tarjeta-outlined" value="transferencia" autocomplete="off">
                                                    <label class="btn btn-outline-info" for="tarjeta-outlined">
                                                        <i class="px-2 bi-credit-card" style="font-size: 1rem;"></i>
                                                        <p class="mb-0" style="font-size: 0.9rem;" >Bancos</p>
                                                    </label>

                                                </div>

                                                <div class="">
                                                    <input type="radio" (click)="limpiarPagos()" class="btn-check" name="options-outlined" name="type" formControlName="type" id="mixto-outlined" value="mixto" autocomplete="off">
                                                    <label class="btn btn-outline-dark" for="mixto-outlined">
                                                        <i class="px-2 bi-patch-question" style="font-size: 1rem;"></i>
                                                        <p class="mb-0" style="font-size: 0.9rem;" >Mixto</p>
                                                    </label>

                                                </div>

                                                <div class="">
                                                    <input type="radio" (click)="limpiarPagos('credito')" #tcredito class="btn-check" name="options-outlined" name="type" formControlName="type" id="credito-outlined" value="credito" autocomplete="off">
                                                    <label class="btn btn-outline-warning" for="credito-outlined">
                                                        <i class="px-2 bi-clock-history" style="font-size: 1rem;"></i>
                                                        <p class="mb-0" style="font-size: 0.9rem;" >Credito</p>
                                                    </label>
                                                </div>

                                            </div>

                                            <div class="d-flex justify-content-center flex-row flex-wrap gap-2 mb-3" *ngIf="invoiceForm.value.type === 'efectivo' || invoiceForm.value.type === 'mixto' || invoiceForm.value.type === 'credito'">

                                                <div>
                                                    <a type="button" (click)="agregarPagos('efectivo', 100000, '', false)">
                                                        <img src="../../../../assets/img/billetes/100.svg" alt="" style="max-width: 60px; height: 30px;">
                                                    </a>
                                                </div>
                                                <div>
                                                    <a type="button" (click)="agregarPagos('efectivo', 50000, '', false)">
                                                        <img src="../../../../assets/img/billetes/50.svg" alt="" style="max-width: 60px; height: 30px;">
                                                    </a>
                                                </div>
                                                <div>
                                                    <a type="button" (click)="agregarPagos('efectivo', 20000, '', false)">
                                                        <img src="../../../../assets/img/billetes/20.svg" alt="" style="max-width: 60px; height: 30px;">
                                                    </a>
                                                </div>
                                                <div>
                                                    <a type="button" (click)="agregarPagos('efectivo', 10000, '', false)">
                                                        <img src="../../../../assets/img/billetes/10.svg" alt="" style="max-width: 60px; height: 30px;">
                                                    </a>
                                                </div>
                                                <div>
                                                    <a type="button" (click)="agregarPagos('efectivo', 5000, '', false)">
                                                        <img src="../../../../assets/img/billetes/5.svg" alt="" style="max-width: 60px; height: 30px;">
                                                    </a>
                                                </div>
                                                <div>
                                                    <a type="button" (click)="agregarPagos('efectivo', 2000, '', false)">
                                                        <img src="../../../../assets/img/billetes/2.svg" alt="" style="max-width: 60px; height: 30px;">
                                                    </a>
                                                </div>

                                            </div>

                                            

                                            <div class="mx-auto my-3" *ngIf="invoiceForm.value.type === 'credito'">

                                                <div class="form-check">
                                                    <input formControlName="apartado" class="form-check-input" type="checkbox" value="" id="apartado">

                                                    <label class="form-check-label h4" for="apartado">
                                                      Con sistema de apartado
                                                    </label>
                                                </div>

                                            </div>

                                            <div class="mx-auto">

                                                <!-- TABLA -->
                                                <div class="table-responsive" *ngIf="payments.length > 0">
                                                    <table class="table table-sm table-borderless">
                                                        <thead>
                                                            <tr>
                                                                <th>#</th>
                                                                <th>Descripcion</th>
                                                                <th>Monto</th>
                                                                <th></th>
                                                            </tr>
                                                        </thead>
                                                        <tbody formArrayName="payments">
                                                            <tr class="trHover" *ngFor="let control of payments; let i = index">
                                                                <th>{{ i + 1}}</th>
                                                                <td>
                                                                    <p class="mb-0">{{ control.type }} <span *ngIf="control.description">- {{ control.description }}</span></p>
                                                                </td>
                                                                <td> {{ control.amount | divisa }} </td>
                                                                <td>
                                                                    <button type="button" class="btn btn-link p-1 text-danger text-right" (click)="eliminarPagos(control)"> <i class="bi-trash"></i> </button>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>

                                                </div>
                                                <!-- TABLA -->

                                                <!-- FECHA DE VENCIMIENTO -->
                                                <hr *ngIf="credit">
                                                <div class="col-auto mb-3" *ngIf="credit">
                                                    <label for="credi" class="">Fecha de vencimiento de la factura</label>
                                                    <input type="date" formControlName="fechaCredito" class="form-control" id="credi" placeholder="Selecciona una fecha limite" #fechCredito>
                                                </div>
                                                <hr *ngIf="credit">

                                                <!-- FECHA DE VENCIMIENTO -->

                                                <!-- AGREGAR METODO DE PAGO -->

                                                <div class="row g-3 d-flex justify-content-center">

                                                    <div class="col-auto">

                                                        <select class="form-select" aria-label="Default select example" (change)="typeAdd.value" #typeAdd>
                                                            <option *ngIf="invoiceForm.value.type === 'efectivo' || invoiceForm.value.type === 'mixto' || invoiceForm.value.type === 'credito'" value="efectivo">Efectivo</option>                                                     
                                                            <ng-container *ngIf="invoiceForm.value.type !== 'efectivo'">
                                                                <option *ngFor="let banco of bancos" [value]="banco.name"> {{banco.name}}</option>                                                                
                                                            </ng-container>
                                                        </select>

                                                    </div>

                                                    <div class="col-auto">
                                                        <label for="Descripción" class="visually-hidden">Descripción</label>
                                                        <input type="text" class="form-control w100" id="Descripción" placeholder="Descripción" (keyup)="descripcionAdd.value" #descripcionAdd>
                                                    </div>

                                                    <div class="col-auto">
                                                        <label for="monto" class="visually-hidden">Monto</label>
                                                        <input type="number" class="form-control" id="monto" placeholder="Monto" autofocus="true" (keyup)="montoAdd.value" #montoAdd>
                                                    </div>

                                                    <div class="col-auto">
                                                        <button [disabled]="vueltos >= 0 && this.payments.length > 0 " type="button" class="btn btn-primary mb-3" (click)="agregarPagos(typeAdd.value, montoAdd.value, descripcionAdd.value, tcredito.checked)">Agregar</button>
                                                    </div>

                                                </div>
                                                <!-- AGREGAR METODO DE PAGO -->

                                                <hr>
                                                <div>
                                                    <h4>Dividir Cuenta</h4>
                                                    <button class="btn btn-primary mb-3" type="button" data-bs-toggle="collapse" data-bs-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
                                                        Ver Productos
                                                    </button>

                                                    <div class="collapse" id="collapseExample">
                                                        <div class="card card-body">

                                                            <!-- TOTAL -->
                                                            <div class="text-center my-3" *ngIf="empresa">
                                                                <h4 class="display-4 text-primary">{{ total | divisa }}</h4>


                                                                <h5 *ngIf="empresa.usd" class="text-primary fw-normal">{{ (total / empresa.currencyusd ) | number : '1.2-2' }} USD</h5>
                                                                <h5 *ngIf="empresa.cop" class="text-primary fw-normal">{{ (total * empresa.currencycop ) | number : '1.2-2' }} COP</h5>
                                                                <!-- <h4 class="display-4 text-primary" *ngIf="empresa.responsable">{{ total + ((total * empresa.tax)/100) | divisa }}</h4> -->

                                                                <small *ngIf="totalPagos > 0 && totalPagos < total" class="text-danger animated fadeIn">Resta</small>
                                                                <small *ngIf="totalPagos > 0 && totalPagos >= total" class="text-success animated fadeIn">Vueltos</small>
                                                                <h4 class="mb-0 fw-normal animated fadeIn" [ngClass]=" {   'text-danger': totalPagos < total, 'text-success': totalPagos >= total  }" *ngIf="totalPagos > 0">
                                                                    {{ vueltos | divisa }}
                                                                </h4>

                                                            </div>
                                                            <!-- TOTAL -->

                                                            <div class="table-responsive">
                                                                <table class="table table-borderless table-striped table-hover table-sm animated fadeIn ">
                                                                    <thead class="border-bottom ">
                                                                        <tr>
                                                                            <th class="text-muted text-left" scope="col " colspan="2 ">Descripción</th>
                                                                            <th class="text-muted " scope="col ">Precio</th>
                                                                            <th class="text-muted " scope="col ">Cantidad</th>
                                                                            <th class="text-muted " scope="col ">Monto</th>
                                                                            <th class="text-muted " scope="col "></th>
                                                                        </tr>
                                                                    </thead>
                                                                    <tbody>
                                                                        <tr *ngIf="carrito.length === 0" class="text-center ">
                                                                            <th colspan="10" class="py-4">
                                                                                <h4 class="text-muted">No has seleccionado ningun producto</h4>
                                                                            </th>
                                                                        </tr>

                                                                        <ng-container *ngIf="carrito.length > 0 ">

                                                                            <ng-container *ngFor="let item of carrito; let i = index">
                                                                                <tr class="trHover" *ngIf="item.product">
                                                                                    <td colspan="2">{{ item.product.name }}</td>
                                                                                    <td>{{ item.price | divisa}}</td>
                                                                                    <td class="text-center">
                                                                                        <input class="w-75" min="1" type="number" #cantP (keyup)="cantP.value = cantP.value; addSaldo(item.price, cantP.value)">
                                                                                    </td>
                                                                                    <td>{{ item.price * cantP.value | divisa}}</td>
                                                                                </tr>
                                                                            </ng-container>

                                                                        </ng-container>

                                                                    </tbody>
                                                                </table>
                                                            </div>

                                                            <div class="row g-3 d-flex justify-content-center">

                                                                <div class="col-auto">

                                                                    <select class="form-select" aria-label="Default select example" (change)="typeAddd.value" #typeAddd>
                                                                        <option value="efectivo">Efectivo</option>
                                                                        <option value="transferencia">Transferencia</option>                                                            
                                                                        <ng-container>
                                                                            <option *ngFor="let banco of bancos" [value]="banco.name"> {{banco.name}}</option>                                                                
                                                                        </ng-container>
                                                                    </select>

                                                                </div>

                                                                <div class="col-auto">
                                                                    <label for="Descripción" class="visually-hidden">Descripción</label>
                                                                    <input type="text" class="form-control w100" id="Descripción" placeholder="Descripción" (keyup)="descripcionAdd.value" #descripcionAddd>
                                                                </div>

                                                                <div class="col-auto">
                                                                    <label for="monto" class="visually-hidden">Monto</label>
                                                                    <input type="number" class="form-control" id="monto" placeholder="Monto" (keyup)="montoAddd.value" #montoAddd>
                                                                </div>

                                                                <div class="col-auto">
                                                                    <button type="button" [value]="saldo" class="btn btn-primary mb-3" (click)="agregarPagos(typeAddd.value, montoAddd.value, descripcionAddd.value, tcredito.checked)">Agregar Pago</button>
                                                                </div>

                                                            </div>

                                                        </div>
                                                    </div>


                                                </div>


                                                <hr>

                                                <div class="mb-3">
                                                    <div class="formGroup">
                                                        <label for="propi" class="form-label fw-bold">Servicio</label>
                                                        <input id="propi" (keyup.enter)="changeTip(tipIn.value)" type="number" min="0" class="form-control" placeholder="propina" #tipIn>
                                                    </div>
                                                </div>

                                                <ng-container *ngIf="empresa">

                                                    <div *ngIf="empresa!.datafon">

                                                        <div class="col-md-4">

                                                            <div class="form-check">
                                                                <input class="form-check-input" type="checkbox" id="printpos" #datafonCheck (change)="datafonCheck.checked; activeDatafon(datafonCheck.checked)">
                                                                <label class="form-check-label" for="printpos">
                                                            Comisión de datafon
                                                          </label>
                                                            </div>

                                                        </div>

                                                        <div class="col-md-12 mt-3" *ngIf="datafonCheck.checked">
                                                            <div class="formGroup">
                                                                <label for="datafonCo" class="form-label fw-bold">Comision de datafon</label>
                                                                <input id="datafonCo" (keyup.enter)="changeTip(tipIn.value)" type="number" min="0" class="form-control" placeholder="Datafon" #datafIn [value]="datafon">
                                                            </div>
                                                        </div>


                                                    </div>

                                                    <div *ngIf="empresa.taller" class="mb-3">
                                                        <div class="formGroup">
                                                            <label for="propi" class="form-label fw-bold">Placa</label>
                                                            <input readonly formControlName="placa" id="placa" type="text" class="form-control" placeholder="Placa" (change)="savePlaca(placaIn.value)" #placaIn>
                                                        </div>
                                                    </div>

                                                </ng-container>

                                                <div class="row g-3 d-flex justify-content-center" *ngIf="mesa">

                                                    <div class="mb-5">
                                                        <label for="nota" class="form-label fw-bold">Nota</label>
                                                        <textarea formControlName="nota" class="form-control" id="nota" rows="3" (change)="saveNota(notaTxt.value)" #notaTxt></textarea>
                                                    </div>

                                                </div>

                                            </div>


                                        </form>
                                        <!-- FORM INVOICE - FORM INVOICE -->

                                    </div>

                                </div>
                            </div>


                        </div>
                        <!-- COLUMNA IZQ -->

                    </div>

                    <!-- <div class="d-flex justify-content-end gap-2">
                        <div class="float-end">
                            <button type="button" [disabled]="facturando == true || user.cerrada" (click)="crearFactura(false)" class="btn btn-outline-primary">
                            Crear Factura Pos
                        </button>
                        </div>
                        <div class="float-end" *ngIf="empresa?.electronica">
                            <button type="button" [disabled]="facturando == true || user.cerrada" (click)="crearFactura(true)" class="btn btn-outline-success">
                            Crear Factura Electronica
                        </button>
                        </div>
                    </div> -->


                </div>

                <div class="d-flex justify-content-center mb-3">
                    <div class="card border-0 pb-4" [ngStyle]="{'width': empresa.impresora === 58 ? '14rem' : '24rem'}" style="width: 14rem; color:black; background: white;" id="printDiv2" *ngIf="factura">

                        <!-- EMPRESA -->
                        <div class="card-body px-1 mb-2" style="border-bottom: 2px solid black;" *ngIf="empresa">

                            <div class="d-flex justify-content-center">
                                <img *ngIf="empresa.logo" [src]="empresa.logo | imagen:'logo'" class="mx-auto" width="200px" alt="">
                            </div>

                            <h4 class="card-title mb-0 text-wrap text-center"> {{ empresa.name }} </h4>
                            <p class="text-center mb-0" *ngFor="let text of ticketHeader" style="line-height: 1rem;"> {{ text }} </p>

                        </div>
                        <!-- EMPRESA -->

                        <!-- CLIENTE -->
                        <div class="pb-2" style="border-bottom: 2px solid black;">
                            <h6 class="mb-0 text-wrap text-left">
                                CLIENTE / RAZON SOCIAL <br>
                                <small *ngIf="factura.client" class="text-wrap fw-normal"> {{ factura.client.name }} </small>
                                <small *ngIf="!factura.client" class="text-wrap fw-normal"> Consumidor Final </small>
                            </h6>

                            <h6 class="mb-0 text-wrap text-left">
                                CC / NIT <br>
                                <small *ngIf="factura.client" class="text-wrap fw-normal"> {{ factura.client.cedula }} </small>
                                <small *ngIf="!factura.client" class="text-wrap fw-normal"> 222222222222 </small>
                            </h6>
                            <h6 class="mb-0 text-wrap text-left">
                                TELEFONO <br>
                                <small *ngIf="factura.client" class="text-wrap fw-normal"> {{ factura.client.phone }} </small>
                            </h6>
                            <h6 class="mb-0 text-wrap text-left" *ngIf="factura.client">
                                CIUDAD <br>
                                <small *ngIf="factura.client" class="text-wrap fw-normal"> {{ factura.client.city || '----------'}} </small>
                            </h6>
                            <h6 class="mb-0 text-wrap text-left" *ngIf="factura.client">
                                DIRECCIÓN <br>
                                <small *ngIf="factura.client" class="text-wrap fw-normal"> {{ factura.client.address || '----------'}} </small>
                            </h6>
                            <h6 class="mb-0 text-wrap text-left" *ngIf="factura.placa.length > 0">
                                Placa <br>
                                <small class="text-wrap fw-normal"> {{ factura.placa || '----------'}} </small>
                            </h6>

                            <h6 class="mb-0 text-wrap text-left">
                                <p class="text-wrap fw-normal mb-0"> {{ factura.mesa.name }} - {{ factura.mesero.name }} </p>
                            </h6>
                        </div>
                        <!-- CLIENTE -->

                        <!-- FACTURA -->
                        <div class="py-2" style="border-bottom: 2px solid black;">
                            <h6 class="mb-0 text-wrap text-left">{{ empresa.type }}: <span *ngIf="!factura.cufe"> {{ factura?.invoice }} </span> <span *ngIf="factura.cufe"> {{ factura?.number }} </span></h6>
                            <h6 class="mb-0 text-wrap text-left">Control: {{ factura?.control }}</h6>
                            <small class="mb-0 text-wrap text-left">Fecha: {{ factura.fecha | date:'short' }}</small>
                        </div>
                        <!-- FACTURA -->

                        <table class="table table-borderless table-hover table-sm" [ngClass]=" {'tabla-con-marca': factura.marca && !factura.credito}">
                            <tbody style="color: black;" [ngStyle]="{'fonto-size': empresa.impresora === 80 ? '1.4rem importan!' : '1rem'}">
                                <tr *ngFor="let item of factura.products" class="trHover">
                                    <td class="py-0" [ngStyle]="{'line-height': empresa.impresora === 80 ? '1rem importan!' : '0.8rem'}">
                                        <small class="text-wrap"> {{ item.qty }} x {{item.price | divisa}} </small> <br>
                                        <small class="text-wrap"> {{ item.product.name }} <strong *ngIf="item.mayor" class="fw-bolde text-black">M</strong> </small>
                                    </td>
                                    <td class="text-end">
                                        <small *ngIf="item.product.tax"> {{ item.product.taxid.valor }}% </small>
                                        <small *ngIf="!item.product.tax"> 0% </small>
                                    </td>
                                    <td>
                                        <small *ngIf="!empresa.impuesto" class="text-wrap"> {{ item.qty * item.price | divisa }} </small>
                                        <small *ngIf="empresa.impuesto" class="text-wrap"> {{ (item.qty * item.price) + ((item.qty * item.price) * (item.product.taxid?.valor/100)) | divisa }} </small>
                                    </td>
                                </tr>
                                <tr class="" style="border-top: 2px solid black;">
                                    <td>
                                        <h6 class="mb-0 text-wrap text-left">Sub-total</h6>
                                    </td>
                                    <td class="fw-bold">
                                        <h6 class="mb-0 text-wrap text-rigth"> {{ factura.base | divisa }} </h6>
                                    </td>
                                </tr>

                                <!-- DESCUENTO -->
                                <tr class="" style="border-top: 2px solid black;">
                                    <td>
                                        <h6 class="mb-0 text-wrap text-left">Descuento</h6>
                                    </td>
                                    <td class="fw-bold">
                                        <h6 class="mb-0 text-wrap text-rigth" *ngIf="factura.descuento"> {{ (factura.base * factura.porcentaje )/100 | divisa }} </h6>
                                    </td>
                                </tr>
                                
                                <ng-container *ngIf="!empresa.impuesto">
                                    <tr class="" style="border-top: 2px solid black;">
                                        <td>
                                            <h6 *ngIf="!empresa.impuestos" class="mb-0 text-wrap text-left">No responsable de IVA</h6>
                                        </td>
                                        <td class="fw-bold">
                                            <h6 class="mb-0 text-wrap text-rigth"> 0 </h6>
                                        </td>
                                    </tr>
                                </ng-container>

                                <ng-container *ngIf="empresa.impuesto">
                                    <ng-container *ngFor="let impuesto of impuestos">

                                        <tr *ngIf="impuesto.total > 0" class="" style="border-top: 2px solid black;">
                                            <td>
                                                <h6 class="mb-0 text-wrap text-left"> {{ impuesto.name }} </h6>

                                            </td>
                                            <td class="fw-bold">
                                                <h6 class="mb-0 text-wrap text-rigth"> {{ impuesto.total | divisa }} </h6>
                                            </td>
                                        </tr>
                                    </ng-container>
                                </ng-container>

                                <tr class="" style="border-top: 2px solid black;">
                                    <td>
                                        <h6 class="mb-0 text-wrap text-left">Total</h6>
                                    </td>
                                    <td class="fw-bold">
                                        <h6 class="mb-0 text-wrap text-rigth"> {{ factura.amount - datafon | divisa}} </h6>
                                    </td>
                                </tr>

                                <tr class="" style="border-top: 2px solid black;" *ngIf="empresa.tip">
                                    <td>
                                        <h6 class="mb-0 text-wrap text-left">Servicio Sugerido del {{empresa.propina}}%</h6>
                                    </td>
                                    <td class="fw-bold">
                                        <h6 class="mb-0 text-wrap text-rigth"> {{ factura.tip | divisa }} </h6>
                                    </td>
                                </tr>

                                <tr class="" style="border-top: 2px solid black;" *ngIf="empresa.datafon && datafon > 0">
                                    <td>
                                        <h6 class="mb-0 text-wrap text-left">Datafon Comisión {{empresa.comidatafon}}%</h6>
                                    </td>
                                    <td class="fw-bold">
                                        <h6 class="mb-0 text-wrap text-rigth"> {{ datafon | divisa }} </h6>
                                    </td>
                                </tr>

                                <tr class="" style="border-top: 2px solid black;" *ngIf="empresa.tip">
                                    <td>
                                        <h6 class="mb-0 text-wrap text-left">Total + Servicio <span *ngIf="empresa.datafon && datafon > 0"> + Datafon </span></h6>
                                    </td>
                                    <td class="fw-bold">
                                        <h6 class="mb-0 text-wrap text-rigth"> {{ factura.tip + factura.amount + datafon | divisa}} </h6>
                                    </td>
                                </tr>

                            </tbody>
                            <tfoot>
                                <tr>
                                    <th colspan="">ITEMS</th>
                                    <th> {{ factura.totalItems | number }} </th>
                                </tr>
                            </tfoot>
                        </table>

                        <hr class="my-1">
                        <div *ngIf="!factura.apartado">
                            <p class="mb-0 mx-auto"><small class="text-wrap text-center mb-0">Pago con: {{factura.pago | divisa}} </small></p>
                            <p class="mb-0 mx-auto"><small class="text-wrap text-center mb-0">Vueltos: {{factura.vueltos | divisa}} </small></p>
                        </div>

                        <div *ngIf="factura.apartado">
                            <h6 class="mb-2 fw-bold">Historial de pagos</h6>
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th scope="col">Desc</th>
                                        <th scope="col">Pago</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr *ngFor="let pay of factura.payments">
                                        <td>Abono {{ pay.type }} </td>
                                        <td> {{ pay.amount | divisa }} </td>
                                    </tr>

                                </tbody>
                                <tfoot>
                                    <tr>
                                        <th>Restante</th>
                                        <th> {{ factura.amount - totalPagos | divisa }} </th>
                                    </tr>
                                </tfoot>
                            </table>

                        </div>

                        <hr *ngIf="factura.cufe" class="my-1">

                        <div *ngIf="factura.cufe">
                            <h6 class="mb-0">cufe:</h6>
                            <p class="">- {{ factura.cufe }} </p>

                            <div class="qrcodeImage d-flex justify-content-center">
                                <qrcode [qrdata]="'https://catalogo-vpfe.dian.gov.co/document/searchqr?documentkey='+factura.cufe" [allowEmptyString]="true" [alt]="'A custom alt attribute'" [ariaLabel]="'QR Code image with the following content...'" [cssClass]="'center'" [colorDark]="'#000'"
                                    [colorLight]="'#ffffffff'" [elementType]="'img'" [errorCorrectionLevel]="'M'" [margin]="3" [scale]="1" [title]="'A custom title attribute'" [width]="200"></qrcode>
                            </div>
                        </div>


                        <hr class="my-1">


                        <h6 class="mb-0">Nota:</h6>
                        <p class="">- {{ factura.nota }} </p>


                        <hr *ngIf="factura.nota" class="my-1">

                        <p class="text-center mb-0" *ngFor="let text of ticketfooter" style="line-height: 1rem;"> {{ text }} </p>

                    </div>
                </div>

                <div class="d-flex justify-content-center mb-3" *ngIf="printComandaC">
                    <div class="card border-0 pb-4" [ngStyle]="{'width': empresa.impresora === 58 ? '14rem' : '24rem'}" style="width: 14rem; color:black; background: white;" id="printComanda">
                        <div class=" text-wrap bg-white p-3 position-relative">
                            <h2 class="mb-2 text-center">Orden # {{ mesa.fecha | date: 'H-ms' }}</h2>
                            <i [ngClass]="{'text-danger': mesa.disponible == false, 'text-success': mesa.disponible == true}" class="bi-dot position-absolute top-0 start-100 translate-middle pe-4 pt-2" style="font-size: 2.5rem;"></i>
                            <h5 class="mb-0 text-center text-wrap text-capitalize">{{ mesa.name }}</h5>
                            <h6 class="mb-0 text-center text-wrap text-capitalize fw-normal"> {{ mesa.mesero.name }} </h6>
                            <p class="mb-0 text-center"> Fecha: {{ mesa.fecha | date: "medium" }} </p>
                            <h5 class="mb-0 text-center text-wrap text-capitalize" *ngIf="mesa.cliente?.name">{{ mesa.cliente?.name || 'Consumidor Final' }}</h5>
        
        
                            <div class="table-responsive">
        
                                <table class="table table-sm align-middle">
                                    <thead>
                                        <tr>
                                            <th scope="col">Item</th>
                                            <th scope="col">Estado</th>
                                        </tr>
                                    </thead>
                                    <tbody>
        
                                        <ng-container *ngFor="let item of comandas; let i = index">
        
                                            <tr style="color: black;">
                                                <td>
                                                    <h6 class="mb-0 lh-1 text-capitalize fs-5" style="color: #000;"> <span class="lh-1">01 - {{item.product.name}}  </span></h6>
                                                    <small> {{ item.fecha | date:'short' }} </small>
                                                    <!-- <span *ngFor="let ingrediente of item.ingredientes" class="badge rounded-pill bg-light text-primary fw-normal"> {{ ingrediente.name }} </span> -->
                                                    <ng-container *ngFor="let ingrediente of item.ingredientes">
                                                        <small *ngIf="!ingrediente.status" class="me-1"> X {{ ingrediente.name }} </small>
                                                    </ng-container>

                                                </td>
                                                <td>
                                                    <select class="form-select form-select-sm" aria-label=".form-select-sm example" (change)="cambiarEstado(mesa.comanda, item.product, esta.value, mesa)" #esta>
                                                        <option class="text-danger" value="pendiente" [selected]="item.estado === 'pendiente'">Pendiente</option>
                                                        <option class="text-warning" value="Preparando" [selected]="item.estado === 'Preparando'">Preparando</option>
                                                        <option class="text-success" value="Entregado" [selected]="item.estado === 'Entregado'">Entregado</option>
                                                    </select>
                                                </td>
                                            </tr>
                                        </ng-container>
                                    </tbody>
                                </table>
        
                                <!-- NOTAS -->
                                <div *ngIf="mesa?.nota.length > 0" class="container border rounded overflow-auto" #content style="max-height: 15rem; min-height: 5rem; overflow-x: hidden!important;">
                                    <ul class="list-group list-group-flush py-2" #messages>
                                        <li class="list-group-item border-0 py-1 px-1" *ngFor="let nota of mesa.nota">
                                            <div class="d-flex justify-content-start">
                                                <!-- <div>
                                                    <button type="button" disabled class="btn btn-link p-1 text-danger">
                                                        <i class="bi-trash" style="font-size: 0.9rem"></i>
                                                    </button>
                                                </div> -->
                                                <div class="badge bg-light2 text-muted px-2 py-2 text-wrap text-start" style="width: auto;">
                                                    <h6 class="mb-0 text-break">
                                                        {{ nota.nota }}
                                                    </h6>
                                                    <p class="mb-0 text-end" *ngIf="nota.date "><small class="text-muted"> {{ nota?.date  | date: "medium" }} </small></p>
                                                </div>
                                            </div>
                                        </li>
        
                                    </ul>
                                </div>
                                <!-- NOTAS -->
        
                            </div>
        
                        </div>
                    </div>

                </div>

            </div>

        </div>

    </div>


</div>

<!-- =========================================================================
    TICKET 1 
========================================================================= -->

<!-- =========================================================================
    FOOTER
========================================================================= -->
<div class="fixed-bottom rounded-0  border-end-0 border-start-0 border-bottom-0">

    <div class="card">
        <div class="card-body">

            <div class="d-flex justify-content-between flex-wrap align-items-center">

                <!-- CLIENT -->
                <div>

                    <!-- MESA -->
                    <div *ngIf="mesa">
                        <h6 class="fw-bold mb-0">
                            <span class="text-primary text-wrap">
                            {{ mesa.name }} - {{ mesa.mesero.name }} 
                        </span>
                        </h6>
                    </div>

                    <!-- INFORMACION DEL CLIENTE -->
                    <div class="d-flex flex-column">

                        <div>
                            <h6 class="fw-bold mb-0">CLIENTE: <small> {{ clienteTemp.name }}</small> </h6>
                        </div>
                        <div>
                            <h6 class="fw-bold mb-0">CC/Nit: <small *ngIf="clienteTemp.cedula"> {{ clienteTemp.cedula }} </small> </h6>
                        </div>
                    </div>
                    <!-- INFORMACION DEL CLIENTE -->

                </div>

                <!-- AMOUNT -->
                <div>
                    <div class="text-center" *ngIf="empresa">

                        <p class="h6 fw-normal text-muted mb-0">Sub-total {{ base | divisa }} <span *ngIf="empresa.propina"> + Servicio {{ totalTip | divisa }}</span> <span *ngIf="empresa.datafon && datafon > 0"> + Datafon {{ datafon | divisa }}</span> </p>
                        <p class="h6 fw-normal text-danger mb-0" *ngIf="mesa?.descuento">Descuento {{ ((base * mesa?.porcentaje) / 100) | divisa }}</p>
                        <h4 class="fw-normal display-7 text-primary mb-1">{{ total | divisa }}</h4>
                        <h5 class="mb-0 fw-normal animated fadeIn" [ngClass]=" {   'text-danger': totalPagos < total, 'text-success': totalPagos >= total  }" *ngIf="totalPagos > 0">
                            <small *ngIf="totalPagos > 0 && totalPagos < total" class="text-danger animated fadeIn">Resta:</small>
                            <small *ngIf="totalPagos > 0 && totalPagos >= total" class="text-success animated fadeIn">Vueltos:</small> {{ vueltos | divisa }}
                        </h5>

                    </div>
                    <!-- TOTAL -->
                </div>

                <!-- Buttons -->
                <div *ngIf="empresa">

                    <div class="mx-auto my-3" [ngClass]="{'d-none': !empresa.comandas}">

                        <!-- IMPRIMIR COMANDA -->
                        <div class="form-check">
                            <input #checkCom (change)="printComandaC = checkCom.checked" class="form-check-input" type="checkbox" id="checkCom">

                            <label class="form-check-label h5" for="checkCom">
                                Imprimir Comanda
                            </label>
                        </div>

                    </div>

                    <div class="d-flex justify-content-end gap-2">

                        <!-- <button (click)="crearPedido()" [disabled]="carrito.length === 0 || clienteTemp.cedula === '' || btnPedido === false" type="button" class="btn btn-info mt-2 btnW waves-effect waves-dark text-white"> Crear Pedido </button> -->
                        <!-- BTN PREFACTURA -->
                        <div class="float-end">
                            <button type="button" (click)="timeCommand()" class="btn btn-sm btn-outline-info" data-bs-toggle="modal" data-bs-target="#prefactura">
                            Prefactura
                        </button>
                        </div>
                        <!-- BTN PREFACTURA -->

                        <!-- BTN COTIZACIÓN -->
                        <div *ngIf="empresa?.cotizacion" class="float-end">
                            <button type="button" [disabled]="facturando == true || user.cerrada" (click)="crearFactura(false)" class="btn btn-sm btn-outline-primary">
                                Cotización
                            </button>
                        </div>
                        <!-- BTN COTIZACIÓN -->

                        <!-- BTN CREAR FACTURA -->
                        <div class="float-end" *ngIf="empresa?.electronica">
                            <button type="button" [disabled]="facturando == true || user.cerrada" (click)="crearFactura(true)" class="btn btn-sm btn-outline-success">
                        Crear Factura Electronica
                    </button>
                        </div>
                        <!-- BTN CREAR FACTURA -->
                    </div>

                </div>

            </div>

        </div>
    </div>

</div>

<!-- =========================================================================
    MODAL CREAR CLIENTE 
========================================================================= -->
<div class="modal fade" id="buscarCliente" tabindex="-1" aria-labelledby="buscarClienteModal" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="buscarClienteModal"><i class="bi-people" style="font-size: 1rem"></i>Crear Cliente</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">

                <div class="mt-2">

                    <form autocomplete="off" [formGroup]="newClientForm" (ngSubmit)="crearCliente()">

                        <!-- =======================================================================
                            DATOS PERSONALES 
                        =========================================================================== -->

                        <div class="row mb-2">

                            <!-- Tipo de empresa ** -->
                            <div class="col-md-12 mb-3 px-md-1">
                                <label for="partyType" class="col-sm-auto col-form-label">Tipo de empresa</label>
                                <select formControlName="party_type" class="form-select" id="partyType" #partyType (change)="partyType.value" aria-label="Floating label select example">
                                    <option value="PERSONA_NATURAL">Persona Natural</option>
                                    <option value="PERSONA_JURIDICA" >Persona Juridica</option>
                                </select>
                            </div>

                            <!-- Nombre de la empresa -->
                            <div *ngIf="partyType.value === 'PERSONA_JURIDICA'" class="col-md-12 mb-3 px-md-1">
                                <label for="companyName">Nombre de la empresa </label>
                                <div class="form-floating">
                                    <input id="companyName" formControlName="company_name" type="text" class="form-control text-capitalize" placeholder="Nombre de la empresa">
                                    <label for="floatingInput">Nombre de la empresa </label>
                                </div>
                                <p *ngIf="campoValido('company_name')" class="mb-1 animated fadeIn text-danger"> <small>Este campo es obligatorio</small> </p>
                            </div>

                            <!-- Nombres de la persona natural -->
                            <div *ngIf="partyType.value === 'PERSONA_NATURAL'" class="col-md-12 mb-3 px-md-1">
                                <label for="firstName">Nombres de la persona natural </label>
                                <div class="form-floating">
                                    <input id="firstName" formControlName="first_name" type="text" class="form-control text-capitalize" placeholder="Nombres de la persona natural">
                                    <label for="floatingInput">Nombres de la persona natural </label>
                                </div>
                                <p *ngIf="campoValido('first_name')" class="mb-1 animated fadeIn text-danger"> <small>Este campo es obligatorio</small> </p>
                            </div>

                            <!-- Apellidos de la persona natural -->
                            <div *ngIf="partyType.value === 'PERSONA_NATURAL'" class="col-md-12 mb-3 px-md-1">
                                <label for="familyName">Apellidos de la persona natural </label>
                                <div class="form-floating">
                                    <input id="familyName" formControlName="family_name" type="text" class="form-control text-capitalize" placeholder="Apellidos de la persona natural">
                                    <label for="floatingInput">Apellidos de la persona natural </label>
                                </div>
                                <p *ngIf="campoValido('family_name')" class="mb-1 animated fadeIn text-danger"> <small>Este campo es obligatorio</small> </p>
                            </div>

                            <!-- TIPO DE DOCUMENTO -->
                            <div class="col-md-12 mb-3 px-md-1">
                                <label for="indentityType" class="col-sm-auto col-form-label">Tipo de documento</label>
                                <select formControlName="party_identification_type" class="form-select" id="indentityType" aria-label="Floating label select example">
                                    <option value="NIT">NIT</option>
                                    <option value="CC" selected>CC</option>
                                    <option value="PASAPORTE" >PASAPORTE</option>
                                    <option value="CE" >CE</option>
                                    <option value="TE" >TE</option>
                                    <option value="PEP" >PEP</option>
                                    <option value="TI" >TI</option>
                                    <option value="RC" >RC</option>
                                    <option value="IE" >IE</option>
                                    <option value="NIT_OTRO_PAIS" >Nit de otro pais</option>
                                </select>
                            </div>

                            <!-- CEDULA O NIT -->
                            <div class="col-md-12 mb-3 px-md-1">
                                <label for="cedula">CC / NIT </label>
                                <div class="form-floating">
                                    <input id="cedula" formControlName="cedula" type="text" class="form-control" placeholder="cedula">
                                    <label for="floatingInput">CC / NIT </label>
                                    <p *ngIf="campoValido('cedula')" class="mb-1 animated fadeIn text-danger"> <small>Este campo es obligatorio</small> </p>
                                </div>
                            </div>

                            <!-- EMAIL ** -->
                            <div class="col-md-12 mb-3 px-md-1">
                                <label for="email">Correo electronico </label>
                                <div class="form-floating">
                                    <input id="email" formControlName="email" type="text" class="form-control" placeholder="Correo electronico">
                                    <label for="floatingInput">Correo electronico </label>
                                    <p *ngIf="campoValido('email')" class="mb-1 animated fadeIn text-danger"> <small>Este campo es obligatorio</small> </p>
                                </div>
                            </div>

                            <!-- DEPARTAMENTO ** -->
                            <div class="col-md-12 mb-3 px-md-1">
                                <label for="departamentoS" class="col-sm-auto col-form-label">Departamento</label>
                                <select formControlName="department" class="form-select" id="departamentoS" #departmentSS (change)="searchCities(departmentSS.value)">
                                    <option >Seleccionar Departamento</option>
                                    <option *ngFor="let department of departments" [value]="department.departamento" >{{department.departamento}}</option>
                                </select>
                            </div>

                            <!-- CIUDAD ** -->
                            <div class="col-md-12 mb-3 px-md-1">
                                <label for="ciudadS" class="col-sm-auto col-form-label">Departamento</label>
                                <select formControlName="city" class="form-select" id="ciudadS" aria-label="Floating label select example">
                                    <option value="" selected>Seleccionar Ciudad</option>
                                    <option *ngFor="let city of ListCities" [value]="city.ciudad" >{{city.ciudad}}</option>
                                </select>
                            </div>

                            <!-- DIRECCION ** -->
                            <div class="col-md-12 mb-3 px-md-1">
                                <label for="direccion">Dirección </label>
                                <div class="form-floating">
                                    <input id="direccion" formControlName="address" type="text" class="form-control text-capitalize" placeholder="Dirección">
                                    <label for="floatingInput">Dirección </label>
                                    <p *ngIf="campoValido('address')" class="mb-1 animated fadeIn text-danger"> <small>Este campo es obligatorio</small> </p>
                                </div>

                            </div>

                            <!-- TELEFONO -->
                            <div class="col-md-12 mb-3 px-md-1">
                                <label for="telefono">Telefono </label>
                                <div class="form-floating">
                                    <input id="telefono" formControlName="phone" type="text" class="form-control" placeholder="Telefono">
                                    <label for="floatingInput">Telefono </label>
                                    <p *ngIf="campoValido('phone')" class="mb-1 animated fadeIn text-danger"> <small>Este campo es obligatorio</small> </p>
                                </div>
                            </div>

                            <!-- REGIMEN -->
                            <div class="col-md-12 mb-3 px-md-1">
                                <label for="regimen" class="col-sm-auto col-form-label">Regimen</label>
                                <select formControlName="regimen" class="form-select" id="regimen" aria-label="Floating label select example">
                                    <option value="SIMPLE">SIMPLE</option>
                                    <option value="AUTORRETENEDOR" >AUTORRETENEDOR</option>
                                    <option value="AGENTE_RETENCION_IVA" >AGENTE RETENCION IVA</option>
                                    <option value="ORDINARIO" >ORDINARIO</option>
                                    <option value="GRAN_CONTRIBUYENTE" >GRAN CONTRIBUYENTE</option>
                                </select>
                            </div>

                            <!-- TIPO DE IMPUESTO ** -->
                            <div class="col-md-12 mb-3 px-md-1">
                                <label for="taxLevel" class="col-sm-auto col-form-label">Tipo de impuesto</label>
                                <select formControlName="tax_level_code" class="form-select" id="taxLevel" aria-label="Floating label select example">
                                    <option value="SIMPLIFICADO">SIMPLIFICADO</option>
                                    <option value="RESPONSABLE_DE_IVA" >RESPONSABLE DE IVA</option>
                                    <option value="NO_RESPONSABLE_DE_IVA" selected>NO RESPONSABLE DE IVA</option>
                                    <option value="COMUN" >COMUN</option>
                                </select>
                            </div>

                            <div class="col-md-12 mb-3 px-md-1 ml-2 ms-2">
                                <div class="form-check mt-2">
                                    <input formControlName="sendemail" class="form-check-input" type="checkbox" value="" id="sendemail">
                                    <label class="form-check-label" for="sendemail">
                                        Enviar Factura al Correo
                                    </label>
                                </div>
                            </div>

                        </div>

                        <button type="submit" class="btn btnW waves-effect waves-ligth px-3 btn-primary">Guardar</button>

                    </form>

                </div>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
            </div>
        </div>
    </div>
</div>
<!-- =========================================================================
    MODAL BUSCAR CLIENTE 
========================================================================= -->

<!-- =========================================================================
    BUSCAR PRODUCTO 
========================================================================= -->
<div class="modal fade" id="buscarProducto" tabindex="-1" aria-labelledby="buscarProductoModal" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" style="min-height: 350px;">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="buscarProductoModal"><i class="bi-file-spreadsheet" style="font-size: 1rem"></i> Productos</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">


                <div class="col">

                    <div class="my-2">
                        <div>
                            <label for="precioM">Buscar Productos:</label>
                            <input type="text" class="form-control" placeholder="buscar producto" (keyup.enter)="buscarProductoCode(searchProductCodeN.value)" #searchProductCodeN>
                        </div>
                    </div>

                    <div *ngIf="productSelected" class="mt-4">

                        <div class="form-group">
                            <label for="">Codigo de barras:</label>
                            <input readonly type="text" class="form-control" placeholder="Codigo de Barras" [value]="productSelected.code" #barcode>
                        </div>
                        <div class="form-group">
                            <label for="">Nombre:</label>
                            <input readonly type="text" class="form-control" placeholder="Nombre" [value]="productSelected.name">
                        </div>

                        <div class="row">


                            <div class="form-group col-md-6">
                                <label for="cantidad">Cantidad:</label>
                                <input readonly type="number" min="1" class="form-control" placeholder="" [value]="qtySelect" #cantidadCo>
                            </div>

                            <div class="form-group col-md-6">
                                <label for="precio">Precio:</label>
                                <input type="number" min="1" class="form-control" [value]="priceProductSelected" placeholder="Precio" #precioCo>
                            </div>

                        </div>

                        <div class="form-check form-switch my-2">
                            <input #newPriNew (change)="newPriNew.checked = newPriNew.checked" class="form-check-input" type="checkbox" role="switch" id="newPriceC">
                            <label class="form-check-label" for="newPriceC">Totalizar Precio </label>
                        </div>

                        <button type="button" (click)="carritoTempBefored(productSelected, qtySelect, precioCo.value, '', newPriNew.checked)" class="btn btnW waves-effect waves-ligth px-3 btn-primary">Agregar Producto</button>

                    </div>

                </div>


            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
            </div>
        </div>
    </div>
</div>
<!-- =========================================================================
    BUSCAR PRODUCTO 
========================================================================= -->

<!-- =========================================================================
    MODAL REGISTRAR ENTRADAS Y SALIDAS
========================================================================= -->

<div class="modal fade" id="entradaSalidas" tabindex="-1" aria-labelledby="entradaSalidasModal" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="entradaSalidasModal"><i class="bi-arrow-left-right" style="font-size: 1rem"></i> Movimientos </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body">

                <!-- NAV - NAV -->
                <nav>
                    <div class="nav nav-tabs" id="nav-tab" role="tablist">
                        <a class="nav-link active" id="nav-entradas-tab" data-bs-toggle="tab" href="#nav-entradas" role="tab" aria-controls="nav-entradas" aria-selected="true"><i class="bi-box-arrow-in-right"></i>  Entradas</a>
                        <a class="nav-link" id="nav-salidas-tab" data-bs-toggle="tab" href="#nav-salidas" role="tab" aria-controls="nav-salidas" aria-selected="false"><i class="bi-box-arrow-right"></i> Salidas</a>
                    </div>
                </nav>
                <!-- NAV - NAV -->

                <div class="tab-content" id="nav-tabContent">

                    <!-- ENTRADAS - ENTRADAS - ENTRADAS -->
                    <div class="tab-pane fade show active" id="nav-entradas" role="tabpanel" aria-labelledby="nav-entradas-tab">

                        <div class="py-4">

                            <div class="form-group">
                                <label for="">Entrada</label>
                                <input type="number" class="form-control" placeholder="Monto de entrada" #montoE>
                            </div>

                            <div class="form-group">
                                <label for="">Descripción</label>
                                <input type="text" class="form-control" placeholder="Descripción" #descriptionE>
                            </div>

                            <div class="col py-2">
                                <button [disabled]="sendMovimiento" type="button" (click)="entradaSalida('entrada', descriptionE.value, montoE.value)" class="btn btnW waves-effect waves-ligth px-3 btn-primary">
                                    <span *ngIf="!sendMovimiento">Guardar</span>
                                    <span *ngIf="sendMovimiento">Guardando...</span>                                    
                                </button>
                            </div>

                        </div>


                    </div>
                    <!-- ENTRADAS - ENTRADAS - ENTRADAS -->
                    <!-- SALIDAS - SALIDAS - SALIDAS -->
                    <div class="tab-pane fade" id="nav-salidas" role="tabpanel" aria-labelledby="nav-salidas-tab">

                        <div class="py-4">

                            <div class="form-group">
                                <label for="">Salida</label>
                                <input type="number" class="form-control" placeholder="Monto de salida" #montoS>
                            </div>

                            <div class="form-group">
                                <label for="">Descripción</label>
                                <input type="text" class="form-control" placeholder="Descripción" #descriptionS>
                            </div>

                            <div class="col py-2">
                                <button type="button" (click)="entradaSalida('salida', descriptionS.value, montoS.value)" class="btn btnW waves-effect waves-ligth px-3 btn-primary">Guardar</button>
                            </div>

                        </div>

                        <ng-container *ngIf="empresa && movimiento">
                            <div [ngStyle]="{'width': empresa.impresora === 58 ? '14rem' : '24rem'}" style="width: 14rem; color:black; background: white;" id="printDiv4">
                                <div class="card">
                                    <div class="text-center" style="color: #000;">
                                        <h4 class="mb-0 fw-normal">Salida</h4>
                                        <h2 class="fw-bold"> {{ movimiento.monto | divisa}} </h2>
                                        <p class="mb-0"> {{ movimiento.user.name }} </p>
                                        <p> {{ movimiento.fecha | date: 'short' }} </p>
                                    </div>
                                </div>
                            </div>
                        </ng-container>

                    </div>
                    <!-- SALIDAS - SALIDAS - SALIDAS -->
                </div>

            </div>
        </div>
    </div>
</div>
<!-- =========================================================================
    MODAL REGISTRAR ENTRADAS Y SALIDAS
========================================================================= -->

<!-- =========================================================================
VERIFICADOR DE PRECIOS
========================================================================= -->
<div class="modal fade" id="verificarPrecio" tabindex="-1" aria-labelledby="verificarPrecioModal" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="verificarPrecioModal"><i class="bi-upc-scan" style="font-size: 1rem"></i> Verificar Precio </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body">

                <div class="text-center pb-4">
                    <h4 class="text-muted">Comprobar Precio</h4>
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Escanear Codigo" (keyup.enter)="comprobrarPrecio(comprobarPrecio.value)" #comprobarPrecio>
                    </div>

                    <div *ngIf="productoCom" class="mt-4">
                        <h6 class="text-muted mb-0"> {{ productoCom.name }} </h6>
                        <h4 class="display-2 text-primary"> {{ productoCom.price | divisa }} </h4>
                    </div>

                </div>

            </div>
        </div>
    </div>
</div>

<!-- =========================================================================
VERIFICADOR DE PRECIOS
========================================================================= -->

<!-- =========================================================================
COMANDAS
========================================================================= -->
<div class="modal fade" id="comandas" tabindex="-1" aria-labelledby="comandasModal" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="comandasModal"><i class="bi-upc-scan" style="font-size: 1rem"></i> COMANDAS: </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body">

                <div class="row">

                    <!-- COMENTARIO -->
                    <div class="col-sm-12 col-md-6">
                        <div class="container border rounded overflow-auto" #content style="max-height: 15rem; min-height: 10rem;">

                            <p class="mb-1 fw-bold mt-2 text-muted">Notas:</p>

                            <ul class="list-group list-group-flush py-2" #messages>
                                <li class="list-group-item border-0 py-1 px-1" *ngFor="let nota of notas; let i = index">
                                    <div class="d-flex justify-content-start">
                                        <div>
                                            <button (click)="eliminarComentario(i)" type="button" class="btn btn-link p-1 text-danger">
                                                <i class="bi-trash" style="font-size: 0.9rem"></i>
                                            </button>
                                        </div>
                                        <div class="badge bg-light2 text-muted px-2 py-2 text-wrap text-start" style="width: auto;">
                                            <h6 class="mb-0 text-break">
                                                {{ nota.nota }}
                                            </h6>
                                            <p class="mb-0 text-end" *ngIf="nota.date "><small class="text-muted"> {{ nota?.date  | date: "medium" }} </small></p>
                                        </div>
                                    </div>
                                </li>

                            </ul>
                        </div>

                        <!-- MENSAJE -->
                        <!-- <div class="clearfix my-2">
                            <input type="text" name="" id="" class="form-control float-start col-8" placeholder="Notas" (keyup)="nota.value" (keyup.enter)="enviarNota(nota.value)" #nota>
                            <button type="button" (click)="enviarNota(nota.value)" class="btn btn-primary  ms-auto float-end col-3"> <i class="bi-arrow-right"></i> </button>
                        </div> -->

                        <div class="input-group my-2">
                            <input type="text" class="form-control" placeholder="Notas" aria-label="Notas" aria-describedby="button-addon2" (keyup)="nota.value" (keyup.enter)="enviarNota(nota.value)" #nota>
                            <button class="btn btn-primary" (click)="enviarNota(nota.value)" type="button" id="button-addon2">Enviar</button>
                        </div>

                    </div>

                    <!-- COMANDA -->
                    <div class="col-sm-12 col-md-6">

                        <div class="container border rounded overflow-auto" style="max-height: 15rem; min-height: 10rem;">

                            <p class="mb-1 fw-bold mt-2 text-muted">Comanda</p>

                            <!-- PRODUCTOS DE LAS COMANDAS -->
                            <ul class="py-1 px-0 list-group list-group-flush">
                                <li class="mb-2 border-bottom border-info py-1 px-0 list-group-item" *ngFor="let comanda of comandas; let i=index">
                                    <span class=" py-1 px-2 fw-bold text-uppercase bg-dark text-white ">{{ i + 1 }} - {{ comanda.product?.name }} </span>

                                    <!-- INGREDIENTES -->
                                    <ul class=" py-1 px-0 ps-1 list-group list-group-flush">
                                        <li class=" py-1 px-0 list-group-item" *ngFor="let ingrediente of comanda.ingredientes; let y = index">
                                            <button (click)="eliminarIngredientes(ingrediente._id, y)" type="button" class="btn btn-link p-1 text-danger">
                                                <i class="bi-trash" style="font-size: 0.9rem"></i>
                                            </button> <i class="bi-x" *ngIf="!ingrediente.status"></i> {{ ingrediente.name }}
                                        </li>
                                    </ul>
                                    <!-- INGREDIENTES -->
                                </li>
                            </ul>

                            <!-- PRODUCTOS DE LAS COMANDAS -->

                        </div>

                    </div>

                </div>

            </div>
        </div>
    </div>
</div>

<!-- =========================================================================
Cambiar Mesa
========================================================================= -->
<div class="modal fade" id="cambiarMesa" tabindex="-1" aria-labelledby="cambiarMesa" aria-hidden="true">
    <div class="modal-dialog molda-lg modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="cambiarMesa">
                    <i class="bi-arrow-repeat" style="font-size: 1rem"></i> Cambiar Mesa </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body">

                <h4 class="mb-0 fw-bold">Selecciona la mesa que quieres cambiar</h4>
                <hr>

                <div class="d-flex flex-row justify-content-center flex-wrap gap-3 py-4">

                    <ng-container *ngFor="let mesa of totalMesas">
                        <a type="button" (click)="cambiarMesa(mesa)" class="px-3 shadow text-decoration-none" *ngIf="mesa.img === 'mesa.svg' && mesa.disponible === true">
                            <img src="../../../assets/img/icons/{{ mesa.img }}" alt="" style="max-height: 100px; stroke:white;">
                            <p class="pb-0 text-center fw-bold text-capitalize text-break ">{{ mesa.name }}</p>
                        </a>

                    </ng-container>



                </div>

            </div>
        </div>
    </div>
</div>

<!-- =========================================================================
CAMBIAR MESA
========================================================================= -->

<!-- =========================================================================
APLICAR DESCUENTO
========================================================================= -->
<div class="modal fade" id="descuentoModal" tabindex="-1" aria-labelledby="descuentoM" aria-hidden="true">
    <div class="modal-dialog molda-lg modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="descuentoM">Aplicar descuento </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body">

                <p class="mb-2 fs-4 text-muted"> Agrega el porcentaje de descuento</p>

                <form [formGroup]="formDescuento" (ngSubmit)="descuentos()">

                    <div class="form-group">
                        <label for="descc"></label>
                        <input formControlName="porcentaje" min="0" type="number" class="form-control" name="descc" id="" aria-describedby="helpId" placeholder="Porcentaje">

                    </div>

                    <button type="submit" name="" id="" class="btn btn-primary btn-lg btn-block"> Guardar </button>

                </form>

            </div>
        </div>
    </div>
</div>

<!-- =========================================================================
APLICAR DESCUENTO
========================================================================= -->

<!-- =========================================================================
PREFACTURA
========================================================================= -->
<div class="modal fade" id="prefactura" tabindex="-1" aria-labelledby="prefactura" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="prefactura">
                    <i class="bi-reciept" style="font-size: 1rem"></i> Prefactura </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body">

                <div id="copiaPre" style="width: 24rem; color:black; background: white;">

                    <!-- EMPRESA -->
                    <div class="card-body px-1 mb-2" style="border-bottom: 2px solid black;" *ngIf="empresa">

                        <h4 class="card-title mb-0 text-wrap text-center"> {{ empresa.name }} </h4>
                        <p class="text-center mb-0" *ngFor="let text of ticketHeader" style="line-height: 1rem;"> {{ text }} </p>
                    </div>
                    <!-- EMPRESA -->

                    <div *ngIf="mesa">
                        <p class="text-center fs-4"> {{ mesa.name }} </p>
                    </div>

                    <div class="table-responsive">

                        <table class="table table-sm table-striped align-middle">
                            <thead>
                                <tr class="align-middle">
                                    <th scope="col">Item</th>
                                    <th scope="col">Precio</th>
                                    <th scope="col">Cantidad</th>
                                    <th scope="col">Monto</th>
                                </tr>
                            </thead>
                            <tbody>

                                <tr *ngIf="carrito.length === 0">
                                    <th scope="row" colspan="5"> No has seleccionado ningun producto</th>
                                </tr>

                                <tr *ngFor="let producto of carrito">
                                    <th scope="row"> {{ producto.product.name }} </th>
                                    <td> {{ producto.price | divisa }} </td>
                                    <td class="text-center"> {{ producto.qty | number }} </td>
                                    <td> {{ (producto.qty * producto.price) | divisa }} </td>
                                </tr>

                            </tbody>
                            <tfoot>
                                <tr>
                                    <td colspan="4" class="text-end">
                                        <div class="col ms-auto text-end" *ngIf="empresa">
                                            <p class="h6 fw-bold mb-0" *ngIf="!empresa.responsable">Sub-total: {{ base / 1 | divisa }}</p>
                                            <p class="h6 fw-bold mb-0" *ngIf="empresa.responsable">Sub-total: {{ base - iva | divisa }}</p>
                                            <p class="h6 fw-bold mb-0" *ngIf="mesa?.descuento">Descuento: {{ (base * mesa?.porcentaje) /100 | divisa }}</p>
                                            <p class="h6 fw-bold mb-0" *ngIf="empresa.responsable">IVA: {{ iva | divisa }}</p>
                                            <p class="fw-bold mb-0" [ngClass]="{'h4': empresa.tip === false, 'h6': empresa.tip }" *ngIf="!empresa.responsable">Total: {{ (total - totalTip ) | divisa }}</p>
                                            <p class="fw-bold mb-0" [ngClass]="{'h4': empresa.tip === false, 'h6': empresa.tip }" *ngIf="empresa.responsable">Total: {{ (total - totalTip ) | divisa }}</p>
                                            <p class="h6 fw-bold mb-0" *ngIf="empresa.tip"> Servicio del {{empresa.propina}}%: {{ totalTip | divisa }}</p>
                                            <p class="h4 fw-bold mb-0" *ngIf="empresa.tip"> Total + Servicio: {{ total | divisa }}</p>
                                            <p class="h4 fw-bold mb-0" *ngIf="empresa.usd"> Total USD: {{ (total / empresa.currencyusd ) | number : '1.2-2' }}</p>
                                            <p class="h4 fw-bold mb-0" *ngIf="empresa.bs"> Total BS: {{ (total / empresa.currencybs ) | number : '1.2-2' }}</p>
                                        </div>
                                    </td>
                                </tr>
                            </tfoot>
                        </table>


                    </div>



                </div>
                <button type="button" class="btn btn-primary btn-lg btn-block" (click)="prefactura()">imprimir</button>

            </div>
        </div>
    </div>
</div>

<!-- =========================================================================
PREFACTURA
========================================================================= -->
<!-- =========================================================================
PRODUCT SELECT
========================================================================= -->
<ng-template #modalProductSeleted let-close="close">

    <div class="modal-header">
        <h5 class="modal-title">Producto</h5>
        <button type="button" class="close" (click)="close()">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>

    <div class="modal-body">
        <div class="d-flex flex-wrap">
            <p class="mb-0">Codigo: <small> {{productSelected.code}} </small></p>
            <p class="mb-0 ms-auto"> stock: {{ productSelected.inventario | number }}</p>
        </div>
        <h4 class="mb-0 text-break"> {{ productSelected.name }} </h4>
        <p class="mb-2" *ngIf="productSelected.inventario <= productSelected.min &&  productSelected.type !== 'Paquete'"><span class="badge bg-warning text-dark">Inventario Bajo</span></p>
        
        <!-- PRICES -->
        <div>
            <!-- <h4 class="display-5 mb-2 text-center text-success fw-bold"> $ {{ priceProductSelected * (qtySelect || 1) | number: '':'en-US' }} </h4> -->
            <h4 *ngIf="!newPri.checked" class="display-5 mb-2 text-center text-success fw-bold"> {{ priceProductSelected * qtySelect | number: '':'en-US' }} </h4>
            <h4 *ngIf="newPri.checked" class="display-5 mb-2 text-center text-success fw-bold"> {{ ((priceProductSelected / (qtySelect * 1000)) * 1000 ) * qtySelect | number: '':'en-US' }} </h4>

        </div>
        <!-- PRICES -->

        <label for="canttt">Cantidad:</label>

        <div class="input-group mb-2">

            <button class="btn btn-primary" type="button" id="button-addon1" (click)="cambiarValor(-1)"> - </button>

            <input #canttt type="number" [max]="productSelected.inventario" min="0" class="form-control" placeholder="" (ngModelChange)="onChange($event)" [(ngModel)]="qtySelect" (keyup.enter)="carritoTemp(productSelected, qtySelect, pricePr.value); close()">

            <button class="btn btn-primary" type="button" id="button-addon2" (click)="cambiarValor(1)"> + </button>
        </div>

        <div class="container my-2">
            <div class="d-flex flex-row gap-4">
                <div class="form-check form-switch">
                    <input [disabled]="user.role !== 'ADMIN' && user.role !== 'STAFF' || cDis.checked" #cMayor (change)="mayoreoApp(cMayor.checked)" class="form-check-input" type="checkbox" role="switch" id="flexSwitchCheckDefault">
                    <label class="form-check-label" for="flexSwitchCheckDefault">Mayoreo</label>
                </div>
                <div class="form-check form-switch">
                    <input [disabled]="user.role !== 'ADMIN' && user.role !== 'STAFF' || cMayor.checked " #cDis (change)="distribuidorApp(cDis.checked)" class="form-check-input" type="checkbox" role="switch" id="flexSwitchCheckDefaultDistr">
                    <label class="form-check-label" for="flexSwitchCheckDefaultDistr">Distribuidor</label>
                </div>
                <div class="form-check form-switch">
                    <input [disabled]="user.role !== 'ADMIN' && user.role !== 'STAFF' && user.role !== 'CASHIER'" #newPri (change)="newPri.checked = newPri.checked" class="form-check-input" type="checkbox" role="switch" id="newPriceC">
                    <label class="form-check-label" for="newPriceC">Totalizar Precio </label>
                </div>
            </div>
        </div>

        <label for="pricePr">Precio:</label>
        <div class="input-group">
            <input [readOnly]="user.role !== 'ADMIN' && user.role !== 'STAFF' && user.role !== 'CASHIER'" #pricePr type="number" min="0" class="form-control" placeholder="" [(ngModel)]="priceProductSelected">
        </div>

        <p class="mb-3 text-danger" *ngIf="qtySelect <= 0"> <small> Debes de agregar cantidad </small> </p>
        <p class="mb-3 text-danger text-break" *ngIf="qtySelect > productSelected.inventario && productSelected.type !== 'Paquete'"> <small> La cantidad es mayor de la que tenemos en stock. Stock actual {{ productSelected.inventario | number }} </small> </p>

        <!-- TECLADO NUMERICO -->
        <div class="mt-4" *ngIf="empresa.kiosco">

            <div class="d-flex flex-row gap-1 mb-1">
                <div class="w25"><button class="btn btn-secondary keypad-button" (click)="appendV(7)">7</button></div>
                <div class="w25"><button class="btn btn-secondary keypad-button" (click)="appendV(8)">8</button></div>
                <div class="w25"><button class="btn btn-secondary keypad-button" (click)="appendV(9)">9</button></div>
                <div class="w25"><button class="btn btn-danger keypad-button" (click)="priceProductSelected = ''">C</button></div>
            </div>
            <div class="d-flex flex-row gap-1 mb-1">
                <div class="w25"><button class="btn btn-secondary keypad-button" (click)="appendV(4)">4</button></div>
                <div class="w25"><button class="btn btn-secondary keypad-button" (click)="appendV(5)">5</button></div>
                <div class="w25"><button class="btn btn-secondary keypad-button" (click)="appendV(6)">6</button></div>
                <div class="w25"><button class="btn btn-warning keypad-button" (click)="appendV('del')">←</button></div>
            </div>
            <div class="d-flex flex-row gap-1 mb-1">
                <div class="w25"><button class="btn btn-secondary keypad-button" (click)="appendV(1)">1</button></div>
                <div class="w25"><button class="btn btn-secondary keypad-button" (click)="appendV(2)">2</button></div>
                <div class="w25"><button class="btn btn-secondary keypad-button" (click)="appendV(3)">3</button></div>
                <div class="w25"><button class="btn btn-dark keypad-button" (click)="appendV('00')">00</button></div>
            </div>
            <div class="d-flex flex-row gap-1 mb-1">
                <div class="w50"><button class="btn btn-secondary keypad-button" (click)="appendV(0)">0</button></div>
                <div class="w50"><button class="btn btn-dark keypad-button" (click)="appendV('000')">000</button></div>
            </div>

        </div>
    
    </div>

    <div class="modal-footer">
        <button #btnAddPr ngbAutofocus [disabled]="qtySelect <= 0 || qtySelect > productSelected.inventario && productSelected.type !== 'Paquete'" type="button" class="btn btn-outline-success" (click)="carritoTemp(productSelected, qtySelect, pricePr.value, '',newPri.checked)"
            (click)="close()">
            Agregar
        </button>
    </div>

</ng-template>
<!-- =========================================================================
PRODUCT SELECT
========================================================================= -->
<!-- =========================================================================
UO IMGS
========================================================================= -->
<div class="modal fade" id="imgUp" tabindex="-1" aria-labelledby="imgUp" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="imgUp">
                    <i class="bi-reciept" style="font-size: 1rem"></i> Subir Imagenes </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body">

                <div *ngIf="mesa" class="card">

                    <div class="card-body">

                        <div class="form-group file-area border">
                            <input #fileImg (change)="cambiarImage($event)" type="file" name="images" id="images" required="required" multiple="multiple" />
                            <div class="file-dummy">

                                <div class="default py-5">
                                    <h5 class="text-center card-title text-muted">
                                        Agregar Imagen
                                    </h5>
                                    <p class="text-center card-text fs-2 mb-0">
                                        <i class="mdi mdi-plus"></i>
                                    </p>
                                    <p class="text-center card-text fs-sm">Arrastre la imagen ó dar click aquí</p>
                                </div>

                                <!-- IMG VALIDA -->
                                <div class="success">

                                    <div class="d-flex justify-content-center" *ngIf="imgTempP">
                                        <div class="mx-auto" style="background-image: url({{imgTempP}});width: 400px; height: 300px; background-repeat: no-repeat; background-size: cover; background-position: center center;"></div>
                                    </div>

                                </div>
                                <!-- IMG VALIDA -->
                            </div>
                        </div>

                        <div *ngIf="imgTempP" class="d-flex justify-content-between flex-wrap pt-4 gap-2">
                            <button type="button" class="btn btn-info btn-sm" [disabled]="!subirImagen" (click)="subirImg()"> Subir </button>
                            <button type="button" class="btn btn-danger btn-sm" (click)="imgTempP = ''; fileImg.value = ''"> Eliminar </button>
                        </div>

                        <hr>

                        <div>
                            <h4>Imagenes</h4>
                            <p *ngIf="mesa.images.length === 0">No se han cargado las imagenes</p>
                        </div>

                        <!-- IMGS -->
                        <div *ngIf="mesa.images.length > 0" class="mt-4 d-flex flex-wrap gap-2">

                            <div *ngFor="let file of mesa.images">
                                <div style="background-image: url('{{ file.img | imagen }}');width: 150px; height: 150px; background-repeat: no-repeat; background-size: cover; background-position: center center;">

                                </div>
                                <small class="gallery-item-caption"> {{ file.date | date:'medium' }} </small>
                                <div class="w-100 text-danger">
                                    <a class="text-decoration-none text-danger cursor fs-sm" (click)="deleImg(file.img)">
                                        <i class="ti ti-trash"></i> Eliminar
                                    </a>
                                </div>
                            </div>

                        </div>
                        <!-- IMGS -->

                    </div>
                </div>

            </div>
        </div>
    </div>
</div>

<!-- =========================================================================
UO IMGS
========================================================================= -->